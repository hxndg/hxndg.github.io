<!DOCTYPE html>
<html lang="cn" dir="ltr" class="scroll-smooth" data-default-appearance="light"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-cn" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>汇编笔记 &middot; 菜狗的blog</title>
  <meta name="title" content="汇编笔记 &middot; 菜狗的blog" />
  
  <meta name="description" content="菜狗&#39;s website" />
  <meta name="keywords" content="debug, hex, " />
  
  
  <link rel="canonical" href="https://hxndg.github.io/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.36c3cd7950e4533fa7da3150d972e3edf34d07f83c0264ff04cad0969dfdb3b8a7065b0ed6c730c6d34a7bad516cfc6f6a5917ab1fdb10b25f481f8a17b54c16.css"
    integrity="" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.b6411b5d4cd56c0068d34c4acbce043846adad56b824e3d486a06d3459aed2eb7f7413874b7871cc2c822c8c8834cbed944022918bcc8cca710a962167c36d32.js"
    integrity="sha512-tkEbXUzVbABo00xKy84EOEatrVa4JOPUhqBtNFmu0ut/dBOHS3hxzCyCLIyINMvtlEAikYvMjMpxCpYhZ8NtMg==" data-copy="复制" data-copied="已复制"></script>
  
  
  
  <script src="/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js" integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj&#43;Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://hxndg.github.io/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/">
  <meta property="og:site_name" content="菜狗的blog">
  <meta property="og:title" content="汇编笔记">
  <meta property="og:description" content="菜狗&#39;s website">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-01-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-01-31T00:00:00+00:00">
    <meta property="article:tag" content="Debug">
    <meta property="article:tag" content="Hex">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="汇编笔记">
  <meta name="twitter:description" content="菜狗&#39;s website">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "汇编笔记",
    "headline": "汇编笔记",
    
    
    "inLanguage": "zh-cn",
    "url" : "https:\/\/hxndg.github.io\/posts\/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0\/",
    "author" : {
      "@type": "Person",
      "name": "菜狗"
    },
    "copyrightYear": "2021",
    "dateCreated": "2021-01-31T00:00:00\u002b00:00",
    "datePublished": "2021-01-31T00:00:00\u002b00:00",
    
    "dateModified": "2021-01-31T00:00:00\u002b00:00",
    
    "keywords": ["debug","hex"],
    
    "mainEntityOfPage": "true",
    "wordCount": "13405"
  }]
  </script>


  
  
  <meta name="author" content="菜狗" />
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-6X9LWNJ427"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6X9LWNJ427');
</script>



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">菜狗的blog</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            
            
            
  <a href="/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="菜狗的blog">
        Home
    </p>
</a>



            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Posts">
        Posts
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Tags">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class=" flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="菜狗的blog">
            Home
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Posts">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Tags">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>





  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  
 



  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      汇编笔记
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2021-01-31T00:00:00&#43;00:00">2021 年 1 月 31 日</time><span class="px-2 text-primary-500">&middot;</span><span>13405 字</span><span class="px-2 text-primary-500">&middot;</span><span title="预计阅读">27 分钟</span>
  

  
  
</div>








    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      作者
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      菜狗
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">Focus</div>
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#第一章-第三章">第一章-第三章</a></li>
    <li><a href="#第四章-第五章-逻辑门与逻辑电路">第四章-第五章 逻辑门与逻辑电路</a>
      <ul>
        <li><a href="#41-42-布尔逻辑基础">4.1-4.2 布尔逻辑基础</a></li>
        <li><a href="#43-布尔函数冷处理">4.3 布尔函数冷处理(?)</a></li>
      </ul>
    </li>
    <li><a href="#第六章-cpu">第六章 CPU</a>
      <ul>
        <li><a href="#61-cpu总览">6.1 CPU总览</a></li>
        <li><a href="#62-cpu寄存器">6.2 CPU寄存器</a></li>
        <li><a href="#63-cpu与内存io的交互">6.3 CPU与内存/IO的交互</a></li>
        <li><a href="#64-cpu指令执行流程">6.4 CPU指令执行流程</a></li>
        <li><a href="#65-使用gdb观察程序">6.5 使用GDB观察程序</a></li>
      </ul>
    </li>
    <li><a href="#第七章使用汇编语言编程">第七章：使用汇编语言编程</a></li>
    <li><a href="#x86-寄存器功能"><strong>x86 寄存器功能</strong></a></li>
    <li><a href="#操作数类型"><strong>操作数类型</strong></a></li>
    <li><a href="#寻址方式"><strong>寻址方式</strong></a></li>
    <li><a href="#第八章程序数据-输入存储输出">第八章：程序数据-输入，存储，输出</a>
      <ul>
        <li><a href="#81-83-设计本地变量的栈">8.1-8.3 设计本地变量的栈</a></li>
        <li><a href="#84-本地变量的栈">8.4 本地变量的栈</a></li>
        <li><a href="#85-86-syscall系统调用和32位程序调用流程">8.5-8.6 syscall系统调用和32位程序调用流程</a></li>
      </ul>
    </li>
    <li><a href="#第九章计算">第九章：计算</a>
      <ul>
        <li>
          <ul>
            <li><a href="#932-机器码格式">9.3.2 机器码格式</a></li>
            <li><a href="#933-rex前缀">9.3.3 REX前缀</a></li>
            <li><a href="#934-modrm">9.3.4 modrm</a></li>
            <li><a href="#935-sib">9.3.5 SIB</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第十章流程控制">第十章流程控制</a>
      <ul>
        <li><a href="#101-循环">10.1 循环</a></li>
        <li><a href="#102-二元操作">10.2 二元操作</a></li>
      </ul>
    </li>
    <li><a href="#第十一章">第十一章</a>
      <ul>
        <li><a href="#112-64位参数多于6个">11.2 64位参数多于6个</a></li>
      </ul>
    </li>
    <li><a href="#第十二章位运算乘法除法">第十二章：位运算，乘法除法</a>
      <ul>
        <li><a href="#121-2-逻辑运算">12.1-2 逻辑运算</a></li>
        <li><a href="#123-乘法">12.3 乘法</a></li>
        <li><a href="#124-除法">12.4 除法</a></li>
        <li><a href="#126-取补码">12.6 取补码</a></li>
      </ul>
    </li>
    <li><a href="#第十三章cc语言和汇编的转换">第十三章：C/C++语言和汇编的转换</a>
      <ul>
        <li><a href="#131-部分算数运算的优化和转换">13.1 部分算数运算的优化和转换</a>
          <ul>
            <li><a href="#1311-乘法">13.1.1 乘法</a></li>
            <li><a href="#1312-除法">13.1.2 除法</a></li>
          </ul>
        </li>
        <li><a href="#132-控制流程的汇编">13.2 控制流程的汇编</a></li>
        <li><a href="#133-函数的工作原理">13.3 函数的工作原理</a></li>
        <li><a href="#134-变量在内存中的位置和访问方式">13.4 变量在内存中的位置和访问方式</a></li>
        <li><a href="#135-结构体和类">13.5 结构体和类</a></li>
        <li><a href="#136-构造函数和析构函数">13.6 构造函数和析构函数</a></li>
        <li><a href="#137-虚函数">13.7 虚函数</a></li>
        <li><a href="#138-类的关系">13.8 类的关系</a></li>
      </ul>
    </li>
    <li><a href="#一些代码范例">一些代码范例</a></li>
    <li><a href="#14-linux-二进制分析学习">14 linux 二进制分析学习</a>
      <ul>
        <li><a href="#15--linux-kernel-mod-and-code-protect">15  linux kernel mod and code protect</a></li>
        <li><a href="#151-lkm">15.1 lkm</a></li>
      </ul>
    </li>
    <li><a href="#结尾">结尾</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#第一章-第三章">第一章-第三章</a></li>
    <li><a href="#第四章-第五章-逻辑门与逻辑电路">第四章-第五章 逻辑门与逻辑电路</a>
      <ul>
        <li><a href="#41-42-布尔逻辑基础">4.1-4.2 布尔逻辑基础</a></li>
        <li><a href="#43-布尔函数冷处理">4.3 布尔函数冷处理(?)</a></li>
      </ul>
    </li>
    <li><a href="#第六章-cpu">第六章 CPU</a>
      <ul>
        <li><a href="#61-cpu总览">6.1 CPU总览</a></li>
        <li><a href="#62-cpu寄存器">6.2 CPU寄存器</a></li>
        <li><a href="#63-cpu与内存io的交互">6.3 CPU与内存/IO的交互</a></li>
        <li><a href="#64-cpu指令执行流程">6.4 CPU指令执行流程</a></li>
        <li><a href="#65-使用gdb观察程序">6.5 使用GDB观察程序</a></li>
      </ul>
    </li>
    <li><a href="#第七章使用汇编语言编程">第七章：使用汇编语言编程</a></li>
    <li><a href="#x86-寄存器功能"><strong>x86 寄存器功能</strong></a></li>
    <li><a href="#操作数类型"><strong>操作数类型</strong></a></li>
    <li><a href="#寻址方式"><strong>寻址方式</strong></a></li>
    <li><a href="#第八章程序数据-输入存储输出">第八章：程序数据-输入，存储，输出</a>
      <ul>
        <li><a href="#81-83-设计本地变量的栈">8.1-8.3 设计本地变量的栈</a></li>
        <li><a href="#84-本地变量的栈">8.4 本地变量的栈</a></li>
        <li><a href="#85-86-syscall系统调用和32位程序调用流程">8.5-8.6 syscall系统调用和32位程序调用流程</a></li>
      </ul>
    </li>
    <li><a href="#第九章计算">第九章：计算</a>
      <ul>
        <li>
          <ul>
            <li><a href="#932-机器码格式">9.3.2 机器码格式</a></li>
            <li><a href="#933-rex前缀">9.3.3 REX前缀</a></li>
            <li><a href="#934-modrm">9.3.4 modrm</a></li>
            <li><a href="#935-sib">9.3.5 SIB</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#第十章流程控制">第十章流程控制</a>
      <ul>
        <li><a href="#101-循环">10.1 循环</a></li>
        <li><a href="#102-二元操作">10.2 二元操作</a></li>
      </ul>
    </li>
    <li><a href="#第十一章">第十一章</a>
      <ul>
        <li><a href="#112-64位参数多于6个">11.2 64位参数多于6个</a></li>
      </ul>
    </li>
    <li><a href="#第十二章位运算乘法除法">第十二章：位运算，乘法除法</a>
      <ul>
        <li><a href="#121-2-逻辑运算">12.1-2 逻辑运算</a></li>
        <li><a href="#123-乘法">12.3 乘法</a></li>
        <li><a href="#124-除法">12.4 除法</a></li>
        <li><a href="#126-取补码">12.6 取补码</a></li>
      </ul>
    </li>
    <li><a href="#第十三章cc语言和汇编的转换">第十三章：C/C++语言和汇编的转换</a>
      <ul>
        <li><a href="#131-部分算数运算的优化和转换">13.1 部分算数运算的优化和转换</a>
          <ul>
            <li><a href="#1311-乘法">13.1.1 乘法</a></li>
            <li><a href="#1312-除法">13.1.2 除法</a></li>
          </ul>
        </li>
        <li><a href="#132-控制流程的汇编">13.2 控制流程的汇编</a></li>
        <li><a href="#133-函数的工作原理">13.3 函数的工作原理</a></li>
        <li><a href="#134-变量在内存中的位置和访问方式">13.4 变量在内存中的位置和访问方式</a></li>
        <li><a href="#135-结构体和类">13.5 结构体和类</a></li>
        <li><a href="#136-构造函数和析构函数">13.6 构造函数和析构函数</a></li>
        <li><a href="#137-虚函数">13.7 虚函数</a></li>
        <li><a href="#138-类的关系">13.8 类的关系</a></li>
      </ul>
    </li>
    <li><a href="#一些代码范例">一些代码范例</a></li>
    <li><a href="#14-linux-二进制分析学习">14 linux 二进制分析学习</a>
      <ul>
        <li><a href="#15--linux-kernel-mod-and-code-protect">15  linux kernel mod and code protect</a></li>
        <li><a href="#151-lkm">15.1 lkm</a></li>
      </ul>
    </li>
    <li><a href="#结尾">结尾</a></li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">汇编笔记 
    <div id="%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0" aria-label="锚点">#</a>
    </span>        
    
</h1>
<p>几本书一起看，笔记互相添加，嗯，真是个糟糕的主意。目前实际上是《X86_64组织结构及汇编入门》的笔记，还没有王爽汇编的部分。</p>


<h2 class="relative group">第一章-第三章 
    <div id="%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%AC%AC%E4%B8%89%E7%AB%A0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%AC%AC%E4%B8%89%E7%AB%A0" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>前面几章实际上没啥好说的，也就补码，反码那部分有点意思，不过原先上学的时候都学过。</p>


<h2 class="relative group">第四章-第五章 逻辑门与逻辑电路 
    <div id="%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%80%BB%E8%BE%91%E9%97%A8%E4%B8%8E%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%80%BB%E8%BE%91%E9%97%A8%E4%B8%8E%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">4.1-4.2 布尔逻辑基础 
    <div id="41-42-%E5%B8%83%E5%B0%94%E9%80%BB%E8%BE%91%E5%9F%BA%E7%A1%80" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#41-42-%E5%B8%83%E5%B0%94%E9%80%BB%E8%BE%91%E5%9F%BA%E7%A1%80" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>literal有两个含义</p>
<ul>
<li>In <a href="https://en.wikipedia.org/wiki/Computer_science" target="_blank">computer science</a>, a <strong>literal</strong> is a notation for representing a fixed <a href="https://en.wikipedia.org/wiki/Value_%28computer_science%29" target="_blank">value</a> in <a href="https://en.wikipedia.org/wiki/Source_code" target="_blank">source code</a>. 这个是给编程/计算机科学用的</li>
<li>In <a href="https://en.wikipedia.org/wiki/Mathematical_logic" target="_blank">mathematical logic</a>, a <strong>literal</strong> is an <a href="https://en.wikipedia.org/wiki/Atomic_formula" target="_blank">atomic formula</a> (atom) or its <a href="https://en.wikipedia.org/wiki/Negation" target="_blank">negation</a>. The definition mostly appears in <a href="https://en.wikipedia.org/wiki/Proof_theory" target="_blank">proof theory</a> (of <a href="https://en.wikipedia.org/wiki/Classical_logic" target="_blank">classical logic</a>), e.g. in <a href="https://en.wikipedia.org/wiki/Conjunctive_normal_form" target="_blank">conjunctive normal form</a> and the method of <a href="https://en.wikipedia.org/wiki/Resolution_%28logic%29" target="_blank">resolution</a>. 数学里面是个极简的数学公式</li>
<li>A presence of a variable or its complement in an expression.   布尔算式里面更具体</li>
</ul>
<p>product term布尔逻辑里的“乘积表达式”，minterm每个变量都有的乘积表达式（无论里面是x还是^X），sum of products(SoP)乘积表达式的求和，sum of minterms(SoM)每个乘积表达式都是minterm的SoP</p>
<p>八种使得minterm为1的组合，如图</p>
<p>sum term布尔逻辑里的“加法表达式”，maxterm每个变量都有的加法表达式（无论里面是x还是^X），products of sums(PoS)加法表达式的求乘，product of materms(PoM)每个加法表达式都是maxterm的PoS</p>
<p>八种使得maxterm为0的组合，如图</p>


<h3 class="relative group">4.3 布尔函数冷处理(?) 
    <div id="43-%E5%B8%83%E5%B0%94%E5%87%BD%E6%95%B0%E5%86%B7%E5%A4%84%E7%90%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#43-%E5%B8%83%E5%B0%94%E5%87%BD%E6%95%B0%E5%86%B7%E5%A4%84%E7%90%86" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>mSoP</p>
<p>mPoS</p>
<p>莫利斯卡诺，卡诺图K-map，非常有用的用于分析逻辑的方法，具体方法因为是英文版不是很清楚，明天查清了再写下来。</p>


<h2 class="relative group">第六章 CPU 
    <div id="%E7%AC%AC%E5%85%AD%E7%AB%A0-cpu" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-cpu" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">6.1 CPU总览 
    <div id="61-cpu%E6%80%BB%E8%A7%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#61-cpu%E6%80%BB%E8%A7%88" aria-label="锚点">#</a>
    </span>        
    
</h3>
<ul>
<li>总线</li>
<li>L1缓存</li>
<li>寄存器</li>
<li>指令指针</li>
<li>指令寄存器</li>
<li>控制单元</li>
<li>ALU</li>
<li>标志寄存器</li>
</ul>


<h3 class="relative group">6.2 CPU寄存器 
    <div id="62-cpu%E5%AF%84%E5%AD%98%E5%99%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#62-cpu%E5%AF%84%E5%AD%98%E5%99%A8" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>下面的调用习惯，或者说calling convention是System V AMD64 ABI，还有微软那边的一派别，详情参考https://en.wikipedia.org/wiki/X86_calling_conventions#x86-64_calling_conventions</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="imgs/TABLE6.2X86_64%E5%AF%84%E5%AD%98%E5%99%A8.jpg" alt="表6.1" />
      
    </figure>
</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="imgs/FIG6.2X86_64%E5%AF%84%E5%AD%98%E5%99%A8%E8%AE%BF%E9%97%AE.jpg" alt="图6.2" />
      
    </figure>
</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="imgs/TABLE6.4X86_64%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8.jpg" alt="表6.4" />
      
    </figure>
</p>


<h3 class="relative group">6.3 CPU与内存/IO的交互 
    <div id="63-cpu%E4%B8%8E%E5%86%85%E5%AD%98io%E7%9A%84%E4%BA%A4%E4%BA%92" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#63-cpu%E4%B8%8E%E5%86%85%E5%AD%98io%E7%9A%84%E4%BA%A4%E4%BA%92" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h3 class="relative group">6.4 CPU指令执行流程 
    <div id="64-cpu%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#64-cpu%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>现代处理器体系结构往往采用指令队列，那么如何进行指令执行流程呢？</p>


<h3 class="relative group">6.5 使用GDB观察程序 
    <div id="65-%E4%BD%BF%E7%94%A8gdb%E8%A7%82%E5%AF%9F%E7%A8%8B%E5%BA%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#65-%E4%BD%BF%E7%94%A8gdb%E8%A7%82%E5%AF%9F%E7%A8%8B%E5%BA%8F" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>一些指令:</p>
<ul>
<li>N    代码行数级别的，不进入执行的单步执行</li>
<li>S    代码行数级别的，进入加执行的单步执行</li>
<li>SI   机器码级别的单步执行</li>
<li>Info Reg 查看寄存器</li>
</ul>


<h2 class="relative group">第七章：使用汇编语言编程 
    <div id="%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%BF%E7%94%A8%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%BF%E7%94%A8%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>没什么特别值得记载的，只需要记住</p>
<p>movq %rsp, %rbp  #这里的%用来表示寄存器，AT&amp;T语法的通用格式是movs src, dest。如果是inter语法，那么就反过来 movs dest, src。dest和src中至少得有一个寄存器</p>
<p>movl $0, %eax   #这里的$表示一个常量</p>
<p>leave 指令等同于</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">movq %rbp, %rsp
popq %rbp
</code></pre><ul>
<li>b =&gt; byte =&gt; 8 bits</li>
<li>w =&gt; word =&gt; 16 bits</li>
<li>l =&gt; long =&gt; 32 bits，it&rsquo;s always called dword</li>
<li>q =&gt;quadword =&gt; 64 bis</li>
</ul>
<p>这里显示的都是整数，我们来看点浮点数的指令，下面看到一个不明白的就写一条，慢慢建一个表</p>
<pre tabindex="0"><code> CVTSI2SS — Convert Doubleword Integer to Scalar Single-Precision Floating-Point Value
 CVTSS2SI — Convert Scalar Single-Precision Floating-Point Value to Doubleword Integer
 CVTTSS2SI — Convert with Truncation Scalar Single-Precision Floating-Point Value to Integer
 CVTSS2SD — Convert Scalar Single-Precision Floating-Point Value to Scalar Double-Precision Floating-Point Value
 MOVSS — Move or Merge Scalar Single-Precision Floating-Point Value
</code></pre><p>更具体的指令，看这个：</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/20220615004504759_hu_d632a93eedf663ab.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/20220615004504759_hu_967cd488a2d4e1f4.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/20220615004504759_hu_f463982b635ccfbe.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/20220615004504759_hu_76e087d9c3fa943f.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/20220615004504759_hu_76e087d9c3fa943f.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/20220615004504759_hu_967cd488a2d4e1f4.png"
        alt="image-20220615004504759"
      />
      
    </figure>
</p>
<p>除了上述的内容，还需要多赘述几句寻址方式。首先，x86是小端的典型代表，也就是低地址放低位数据，高地址放高位数据。</p>
<p>寻址方式可以参考链接https://zhuanlan.zhihu.com/p/355261639，下面的内容直接就是我抄过来的，感谢原作者。</p>


<h2 class="relative group"><strong>x86 寄存器功能</strong> 
    <div id="x86-%E5%AF%84%E5%AD%98%E5%99%A8%E5%8A%9F%E8%83%BD" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#x86-%E5%AF%84%E5%AD%98%E5%99%A8%E5%8A%9F%E8%83%BD" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>x86 寄存器功能列表如下：</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://pic4.zhimg.com/80/v2-b5d51c70e6262b9b5e05459e04d0776b_720w.jpg" alt="img" />
    
  </figure>
</p>
<p>在x86的abi中注：以 main 函数中调用函数 add为例 ，main 为调用者，add 为被调用者。在 main 函数调用 add 之前，应该将【EAX, ECX, EDX】保存到栈中，在 add 函数中应该将【EBX, ESI, EDI, EBP】保存到栈中，在函数执行完成后，恢复原始数据。</p>


<h2 class="relative group"><strong>操作数类型</strong> 
    <div id="%E6%93%8D%E4%BD%9C%E6%95%B0%E7%B1%BB%E5%9E%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E7%B1%BB%E5%9E%8B" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>在 x86 指令中，包括三类操作数：立即数、寄存器和存储器引用。</p>
<p><strong>立即数</strong>：即常数，任何可以用 32 位寄存器表示的数，都可以作为立即数。立即数使用前缀<code>$</code>进行表示，后面可跟十进制或者十六进制。使用 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=I_%7Bmm%7D" alt="[公式]" />
    
  </figure>
 代表任意立即数。例如：<code>$0x10</code> 或者 <code>$16</code> ，都表示数字 16。</p>
<p><strong>寄存器</strong>：用符号 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=E_a" alt="[公式]" />
    
  </figure>
 表示任意寄存器 a , 使用 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=R%5BE_a%5D" alt="[公式]" />
    
  </figure>
 表示寄存器 a 的值。</p>
<p><strong>存储器引用</strong>：存储器引用表示存储器某个地址的数据。用 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=M%5BAddr%5D" alt="[公式]" />
    
  </figure>
 表示地址 Addr 的值。</p>


<h2 class="relative group"><strong>寻址方式</strong> 
    <div id="%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>x86 包括 7 种寻址方式，分别为：<em>立即数寻址</em>、<em>寄存器寻址</em>、<em>绝对寻址</em>、<em>间接寻址</em>、<em>基址+偏移寻址</em>、<em>变址寻址</em>、<em>比例变址寻址</em>。</p>
<p>前三种寻址方式的表示即上面立即数的表示方式。</p>
<p><strong>间接寻址</strong>：通过访问寄存器 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=E_a" alt="[公式]" />
    
  </figure>
 的值(
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=R%5BE_a%5D" alt="[公式]" />
    
  </figure>
)，访问对应地址的值。使用符号 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=M%5BR%5BE_a%5D%5D" alt="[公式]" />
    
  </figure>
 表示。例如：<code>EAX</code> 寄存器为 <code>0x0001</code> ，地址 <code>0x0001</code> 的值为<code>0x1234</code>。则 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=M%5BR%5BE_%7Beax%7D%5D%5D" alt="[公式]" />
    
  </figure>
 的值为<code>0x1234</code></p>
<p><strong>基址+偏移寻址</strong>：通过寄存器 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=E_a" alt="[公式]" />
    
  </figure>
 和立即数 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=I_%7Bmm%7D" alt="[公式]" />
    
  </figure>
 ，访问地址：
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=R%5BE_a%5D%2BI_%7BMM%7D" alt="[公式]" />
    
  </figure>
 处的值。使用符号 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=M%5BI_%7BMM%7D%2BR%5BE_a%5D%5D" alt="[公式]" />
    
  </figure>
 表示。</p>
<p>完整寻址方式见下表，我实际上感觉类型存储器，第三行的Imm的写的有点令人迷惑，在x86里面，实际上看到这个的形式应该是<code>mov rax, [0xff]</code>的样子，There’s <em>one</em> exception to this: x86_64 allows for a 64-bit displacement with the <code>a*</code> registers.</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://pic4.zhimg.com/80/v2-c371c38fd4d47996ed1695cdd3309da3_720w.jpg" alt="img" />
    
  </figure>
</p>
<p>立即数 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=Imm" alt="[公式]" />
    
  </figure>
、基址寄存器 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=E_b" alt="[公式]" />
    
  </figure>
、变址寄存器 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=E_i" alt="[公式]" />
    
  </figure>
、比例因子 
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://www.zhihu.com/equation?tex=s" alt="[公式]" />
    
  </figure>
（其值为 1、2、4、8)。</p>
<p>上面都是中文，翻译的莫名其妙的寻址分类，不如直接对应下面的英文的分类</p>
<ul>
<li><code>Displacement</code></li>
<li><code>Base</code></li>
<li><code>Base + Index</code></li>
<li><code>Base + Displacement</code></li>
<li><code>Base + Index + Displacement</code></li>
<li><code>Base + (Index * Scale)</code></li>
<li><code>(Index * Scale) + Displacement</code></li>
<li><code>Base + (Index * Scale) + Displacement</code></li>
<li>rip relative</li>
</ul>
<p>除此之外，具体的可以看下面的图片，</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/asm_memory_address_hu_9261503659b6dadd.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/asm_memory_address_hu_a1630054f9222a4b.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/asm_memory_address_hu_9c61a68b4979916f.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/asm_memory_address_hu_ff6ebf628f89c7b1.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/asm_memory_address_hu_ff6ebf628f89c7b1.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/asm_memory_address_hu_a1630054f9222a4b.png"
        alt=""
      />
      
    </figure>
</p>
<p>ok，let&rsquo;s give a raw example with at&amp;t example:simple example below</p>
<table>
  <thead>
      <tr>
          <th><strong>register direct</strong>:</th>
          <th>The data value is located in a CPU register. <br><em>syntax</em>: name of the register with a “%” prefix.<br><em>example</em>: movl %eax, %ebx</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>immediate</strong> <strong>data</strong>:</td>
          <td>The data value is located immediately after the instruc- tion. Source operand only.<br><em>syntax</em>: data value with a “$” prefix.<br><em>example</em>: movl $0xabcd1234, %ebx</td>
      </tr>
      <tr>
          <td><strong>base register plus offset</strong>:</td>
          <td>The data value is located in memory. The address of the memory location is the sum of a value in a base register plus an offset value.<br><em>syntax</em>: use the name of the register with parentheses around the name and the offset value immediately be- fore the left parenthesis.<br><em>example</em>: movl $0xaabbccdd, 12(%eax)</td>
      </tr>
      <tr>
          <td><strong>rip-relative</strong>:</td>
          <td>The target is a memory address determined by adding an offset to the current address in the rip register.<br> <em>syntax</em>: a programmer-defined label<br> <em>example</em>: je somePlace</td>
      </tr>
      <tr>
          <td><strong>indexed</strong>:</td>
          <td>The data value is located in memory. The address of the memory location is the sum of the value in the base_register plus scale times the value in the in- dex_register, plus the offset.<br/> <em>syntax</em>: place parentheses around the comma separated list (base_register, index_register, scale) and preface it with the offset.<br/> <em>example</em>: movl $0x6789cdef, -16(%edx, %eax, 4)</td>
      </tr>
  </tbody>
</table>
<p>for complex example ,check link <a href="https://blog.yossarian.net/2020/06/13/How-x86_64-addresses-memory" target="_blank">https://blog.yossarian.net/2020/06/13/How-x86_64-addresses-memory</a></p>


<h2 class="relative group">第八章：程序数据-输入，存储，输出 
    <div id="%E7%AC%AC%E5%85%AB%E7%AB%A0%E7%A8%8B%E5%BA%8F%E6%95%B0%E6%8D%AE-%E8%BE%93%E5%85%A5%E5%AD%98%E5%82%A8%E8%BE%93%E5%87%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0%E7%A8%8B%E5%BA%8F%E6%95%B0%E6%8D%AE-%E8%BE%93%E5%85%A5%E5%AD%98%E5%82%A8%E8%BE%93%E5%87%BA" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">8.1-8.3 设计本地变量的栈 
    <div id="81-83-%E8%AE%BE%E8%AE%A1%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E7%9A%84%E6%A0%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#81-83-%E8%AE%BE%E8%AE%A1%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E7%9A%84%E6%A0%88" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>一些最基础的东西：</p>
<ul>
<li>汇编传递参数的时候，用哪个寄存器传参数，约定俗称的，得看ABI。需要保存哪些二进制到栈里，也需要记录values in registers rbx, rbp, rsp, and r12 – r15 be preserved by the called function  。具体的ABISystem V Application Binary Interface AMD64 Architecture Processor Supplement  我上传到了网盘上，哪天上班的路上翻翻看。</li>
<li>栈顶也就是RSP值得位置从来都是有数值的，进栈的时候是先减指针再放入数据<code>sp = sp-8;stack[sp]=value</code>，出栈的时候是先拿出来数据，再加指针<code>var=stack[sp];sp = sp+8</code></li>
<li>.rodata对应于只读数据，</li>
<li>at&amp;t 对应的rbp本地栈上变量的表示方法为<code>offset(register_name)  </code>，实际上我们就是在每个局部函数的栈帧(stack frame  )里修改本地变量，这里的栈帧指针就是frame pointer, rbp寄存器 。而stack pointer就是rsp寄存器</li>
</ul>
<p>被调用函数在进入call之后，也就是刚执行的时候，它的流程为(这里有一点要注意，必须先保存caller&rsquo;s rbp再保存其他寄存器的值)：</p>
<ul>
<li>Save the caller’s value in the frame pointer on the stack.</li>
<li>Copy the current value in the stack pointer to the frame pointer.</li>
<li>Subtract a value from the stack pointer to allow for the local variables.</li>
</ul>
<p>函数执行完毕的时候，我们可以观察到：</p>
<ul>
<li>The local variables are located in an area of the call stack – between the addresses in the rsp and rbp registers.</li>
<li>The rbp register is a pointer to the bottom (the numerically highest address) of the local variable area.</li>
<li>The remaining area of the stack can be accessed using the stack pointer (rsp) as always.</li>
</ul>
<p>下面的两张图，图8.5是刚进入call执行完头几步之后的栈帧的示意图。图8.6是执行完了leave，正要执行ret的时候的栈，可以看到局部变量都被释放了。可以注意到rbp寄存器的值同样是16的倍数。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.5X86_64_after_call_hu_d9ca31e70a2bfed9.jpg 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.5X86_64_after_call_hu_55db717082307889.jpg 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.5X86_64_after_call_hu_eee261b38af3e380.jpg 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.5X86_64_after_call_hu_7e7fa3f3869a9c06.jpg 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.5X86_64_after_call_hu_7e7fa3f3869a9c06.jpg"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.5X86_64_after_call_hu_55db717082307889.jpg"
        alt="图8.5"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.6X86_64_after_leave_before_ret_hu_d0db7608c650f2a8.jpg 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.6X86_64_after_leave_before_ret_hu_8597f3ecb89a3fc6.jpg 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.6X86_64_after_leave_before_ret_hu_f9058834fa04a3b7.jpg 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.6X86_64_after_leave_before_ret_hu_52bc865003b1e00.jpg 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.6X86_64_after_leave_before_ret_hu_52bc865003b1e00.jpg"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/FIG8.6X86_64_after_leave_before_ret_hu_8597f3ecb89a3fc6.jpg"
        alt="图8.5"
      />
      
    </figure>
</p>
<p>几条新的指令，equ指令，leaq指令，ret指令作用不同：</p>
<ul>
<li>ret指令相当于pop %rip</li>
<li>leaq用于取地址</li>
<li>que相当于给某个地址取名字</li>
</ul>
<p>需要注意到，C中有两种类型的变量，static和automatic：</p>
<ul>
<li>atuomatic类型在栈上建立</li>
<li>static程序一致性，该变量就建立了，然后在程序的生命周期一直活着</li>
</ul>


<h3 class="relative group">8.4 本地变量的栈 
    <div id="84-%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E7%9A%84%E6%A0%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#84-%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E7%9A%84%E6%A0%88" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>ABI规定了本地变量的栈上结构应该符合什么规律：</p>
<ul>
<li>Each variable should be aligned on an address that is a multiple of its size.</li>
<li>The address in the stack pointer (rsp) should be a multiple of 16 immediately before another function is called.</li>
</ul>
<p>总之就这两点，具体看ABI。</p>


<h3 class="relative group">8.5-8.6 syscall系统调用和32位程序调用流程 
    <div id="85-86-syscall%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C32%E4%BD%8D%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#85-86-syscall%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C32%E4%BD%8D%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>本质上没啥变化，就不写了</p>


<h2 class="relative group">第九章：计算 
    <div id="%E7%AC%AC%E4%B9%9D%E7%AB%A0%E8%AE%A1%E7%AE%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0%E8%AE%A1%E7%AE%97" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h4 class="relative group">9.3.2 机器码格式 
    <div id="932-%E6%9C%BA%E5%99%A8%E7%A0%81%E6%A0%BC%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#932-%E6%9C%BA%E5%99%A8%E7%A0%81%E6%A0%BC%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>eflags寄存器储存运算的结果。本章基本也属于理解性的东西比较多，唯一一个可能要知道就是编码格式。</p>
<p>每条指令可以拆分成1-15字节，不同的字节有不同的作用：</p>
<ul>
<li>Opcode This is the first byte in the instruction and specifies the basic operation performed by executing the instruction. It can also include operand location.  如果没有prefix那么opecode就是第一个字节，opcode里面实际上也有w位</li>
<li>ModRM  The mode/register/memory byte specifies operand locations and how they are
accessed.</li>
<li>SIB The scale/index/base byte specifies operand locations and how they are accessed.</li>
<li>Data These bytes are used to encode constants, either those that are part of the program, or those that are relative address offsets to operand locations in memory.</li>
<li>Prefix If placed in before the opcode, these modify the behavior of the instruction, typically the size of the operands.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_78af84af71e164db.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_85acc1a2b9cacb69.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_ca6acf03f5322016.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_ece43cafba2e14b3.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_ece43cafba2e14b3.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_85acc1a2b9cacb69.png"
        alt="图8.5"
      />
      
    </figure>
</p>


<h4 class="relative group">9.3.3 REX前缀 
    <div id="933-rex%E5%89%8D%E7%BC%80" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#933-rex%E5%89%8D%E7%BC%80" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>一般不加，加了是为了能够制定用哪个寄存器，使用四位来改变指令，因此REX.R, REX.X, and REX.B bits in the REX prefix byte as the high-order bits for specifying registers.  A fourth bit in the REX prefix, the REX.W bit, is set to 1 when the operand is 64 bits. For all other operand sizes — 8, 16, or 32 bits — REX.W is set to 0.</p>
<p>这里要注意</p>
<ul>
<li>3bit的寄存器字段可以出在opcode/modrm/sib字段里，根据指令的不同。</li>
<li>rex bit包括rex.r，rex.x或者rex.b在REX前缀里</li>
<li>如果需要协商rex前缀，那么64位指令的rex.w位必须为1</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_3_rex_prefix_form_hu_e8d96ce362695f47.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_3_rex_prefix_form_hu_c36c40234a12b712.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_3_rex_prefix_form_hu_b491d35346532220.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_3_rex_prefix_form_hu_893342165eddda56.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_3_rex_prefix_form_hu_893342165eddda56.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_3_rex_prefix_form_hu_c36c40234a12b712.png"
        alt="图8.5"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_3_rex_prefix_field_hu_dfee85b511089fa4.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_3_rex_prefix_field_hu_d8d33a51e5ad7e74.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_3_rex_prefix_field_hu_eaafe8d36022df0b.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_3_rex_prefix_field_hu_6dffd12236ae0597.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_3_rex_prefix_field_hu_6dffd12236ae0597.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_3_rex_prefix_field_hu_d8d33a51e5ad7e74.png"
        alt="图8.5"
      />
      
    </figure>
</p>


<h4 class="relative group">9.3.4 modrm 
    <div id="934-modrm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#934-modrm" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>表明操作数和地址的关系，mm都是11的话，那就是两个寄存器，其他情况会变</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_4_modrm_form_hu_bb2368f4752c5dde.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_4_modrm_form_hu_a297f32b23dbb19e.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_4_modrm_form_hu_5550e900a9c0ef6f.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_4_modrm_form_hu_2d7928a732692265.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_4_modrm_form_hu_2d7928a732692265.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_4_modrm_form_hu_a297f32b23dbb19e.png"
        alt="图8.5"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_2_modrm_field_hu_e4ef9f867ded7f04.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_2_modrm_field_hu_bfef2c4d358b1608.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_2_modrm_field_hu_d8b7d0caacfaf7b9.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_2_modrm_field_hu_1b31ec60c61b198c.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_2_modrm_field_hu_1b31ec60c61b198c.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/table_9_2_modrm_field_hu_bfef2c4d358b1608.png"
        alt="图8.5"
      />
      
    </figure>
</p>


<h4 class="relative group">9.3.5 SIB 
    <div id="935-sib" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#935-sib" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>这个暂时还没看到，先不用着急，等到了13章再回来补上</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_78af84af71e164db.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_85acc1a2b9cacb69.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_ca6acf03f5322016.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_ece43cafba2e14b3.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_ece43cafba2e14b3.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_9_2_instructions_general_form_hu_85acc1a2b9cacb69.png"
        alt="图8.5"
      />
      
    </figure>
</p>
<p>总之，机器码看的我很蛋疼。</p>


<h2 class="relative group">第十章流程控制 
    <div id="%E7%AC%AC%E5%8D%81%E7%AB%A0%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">10.1 循环 
    <div id="101-%E5%BE%AA%E7%8E%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#101-%E5%BE%AA%E7%8E%AF" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>cmp指令，根据后面的b,w,l,q来判断后面的两个操作数。执行的操作是减法，只会改变EFLAGS寄存器的值，包括of,sf,zf,af,pf,cf。</p>
<p>test指令，根据后面的b,w,l,q来判断后面的两个操作数。执行的操作是bit-wise and  。只会改变EFLAGS寄存器的值，包括sf,zf,pf，cf和of都置为0，AF的值未定义。</p>
<p>jcc指令，cc根据不同的条件变化。这里面有个问题就是：</p>
<ul>
<li>比较的时候ja，就是jmp above，jb，就是jmp below也就是两个参与比较的数都是无符号数</li>
<li>比较的时候jg，就是jmp greater，jl，就是jmp below，也就是两个参与比较的数都是有符号数</li>
</ul>
<p>jmp指令，无条件跳转</p>
<p>X86_64汇编拓展指令，有两种：</p>
<ul>
<li>sign extend，往高位补1，比方说movssd，后面两个字符sd分别表示size of the source operand and d the size of the destination operand ，高位补1</li>
<li>zero extend，往高位补0，比方说movzsd，后面两个字符sd分别表示size of the source operand and d the size of the destination operand  ，高位补0</li>
</ul>
<p>inc指令，根据后面的b,w,l,q判断增加的值。有一点需要注意增加的到底是多少位。另一点是需要注意，一块内存，里面放了目标的地址，我们每次加一，是改变这块内存上面放着的地址的值，每次地址加个一。</p>


<h3 class="relative group">10.2 二元操作 
    <div id="102-%E4%BA%8C%E5%85%83%E6%93%8D%E4%BD%9C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#102-%E4%BA%8C%E5%85%83%E6%93%8D%E4%BD%9C" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>二元操作也没啥特别稀奇的，就是流程有点绕，then代码块最后会有个无条件Jmp蹦过else代码块。</p>
<p>对于复杂一些的逻辑操作，比方说<code>while( value&gt;= 0 &amp;&amp; value &lt; 9)</code>就是比较条件多一些，按照顺序比较，和C语言中比较的流程一致，英文叫做short-circuit evaluation.</p>
<p>X86_64提供了一个简单的条件赋值语句，cmovcc  src, dst。不过我感觉看到的不多啊</p>


<h2 class="relative group">第十一章 
    <div id="%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>本章主要是高层语言和汇编语言的实际联系。When one function calls another, the information that is required to provide the interface between the two is called an activation record.  这种调用参数时的传递关系很蛋疼，不过还好X86_64的ABI给出了一整套限制。 In 64-bit mode six of the general purpose registers and a portion of the call stack are used for the activation record. The area of the stack used for the activation record is called a stack frame.</p>
<ul>
<li>调用函数（注意区分“被调用函数”）多于六个参数时，用stack frame传递参数</li>
<li>返回地址</li>
<li>调用函数的帧指针</li>
<li>局部变量</li>
</ul>
<p>常常包含：</p>
<ul>
<li>寄存器里参数的拷贝</li>
<li>Copies of values in the registers that must be preserved by a function — rbx, r12 – r15.</li>
</ul>
<p>除此之外，一些通用规则：</p>
<ul>
<li>Each argument is passed within an 8-byte unit. For example, passing three char values requires three registers. This 8-byte rule also applies to arguments passed on the stack.</li>
<li>Local variables can be allocated to take up only the amount of memory they require. For example, three char values can be accommodated in a three-byte memory area.</li>
<li>The address in the frame pointer (rbp register) must always be a multiple of sixteen. It should never be changed within a function, except during the prologue and epilogue.</li>
<li>The address in the stack pointer (rsp register) must always be a multiple of sixteen before transferring program flow to another function.</li>
</ul>
<p>需要引入一个redzone的概念，The ABI [25] defines the 128 bytes beyond the stack pointer— that is, the 128 bytes at addresses lower than the one in the rsp register — as a red zone. The operating system is not allowed to use this area, so the function can use it for temporary storage of values that do not need to be saved when another function is called.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_11_rsp_redzone_hu_bc7950c73b3740f6.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_11_rsp_redzone_hu_7b065d831eff8fc3.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_11_rsp_redzone_hu_4ac7053ae000118e.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_11_rsp_redzone_hu_974f34d8308ab468.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_11_rsp_redzone_hu_974f34d8308ab468.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_11_rsp_redzone_hu_7b065d831eff8fc3.png"
        alt="figure_11_11_rsp_redzone"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_2_more_than_six_arg_hu_60ba41b897466911.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_2_more_than_six_arg_hu_908dc9013e90b5c7.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_2_more_than_six_arg_hu_93a5afe88b94579f.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_2_more_than_six_arg_hu_bce2c518a3ac298d.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_2_more_than_six_arg_hu_bce2c518a3ac298d.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_2_more_than_six_arg_hu_908dc9013e90b5c7.png"
        alt="figure_11_2_more_than_six_arg"
      />
      
    </figure>
</p>


<h3 class="relative group">11.2 64位参数多于6个 
    <div id="112-64%E4%BD%8D%E5%8F%82%E6%95%B0%E5%A4%9A%E4%BA%8E6%E4%B8%AA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#112-64%E4%BD%8D%E5%8F%82%E6%95%B0%E5%A4%9A%E4%BA%8E6%E4%B8%AA" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>多于6个的时候，倒着（参数列表，从右向左）扔进stack，然后一call，这几个参数正好在栈里面返回地址的上面，如上图和下图所示。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_3_call_stack_hu_9100447b7a9f39d0.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_3_call_stack_hu_f76eef54642e9380.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_3_call_stack_hu_e61d1333732add2c.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_3_call_stack_hu_b4097fac87c1b1b3.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_3_call_stack_hu_b4097fac87c1b1b3.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/figure_11_3_call_stack_hu_f76eef54642e9380.png"
        alt="figure_11_3_call_stack"
      />
      
    </figure>
</p>
<p>总结起来就是：</p>
<p>对于调用函数：</p>
<ul>
<li>Assume that the values in the rax, rcx, rdx, rsi, rdi and r8 – r11 registers will be changed by the called function.</li>
<li>The first six arguments are passed in the rdi, rsi, rdx, rcx, r8, and r9 registers in left-to-right order.</li>
<li>Arguments beyond six are stored on the stack as though they had been pushed onto the stack in right-to-left order.</li>
<li>Use the call instruction to invoke the function you wish to call.</li>
</ul>
<p>刚进入被调用函数时：</p>
<ul>
<li>Save the caller’s frame pointer by pushing rbp onto the stack</li>
<li>Establish a new frame pointer at the current top of stack by copying rsp to rbp.</li>
<li>Allocate space on the stack for all the local variables, plus any required register save space, by subtracting the number of bytes required from rsp; this value must be a multiple of sixteen.</li>
<li>If a called function changes any of the values in the rbx, rbp, rsp, or r12 – r15 registers, they must be saved in the register save area, then restored before returning to the calling function.</li>
<li>If the function calls another function, save the arguments passed in registers on the stack</li>
</ul>
<p>在被调用函数里面的时候：</p>
<ul>
<li>rsp is pointing to the current bottom of the stack that is accessible to this function. Observe the usual stack discipline (see §8.2). In particular, DO NOT use the stack pointer to access arguments or local variables.</li>
<li>Arguments passed in registers to the function and saved on the stack are accessed by negative offsets from the frame pointer, rbp.</li>
<li>Arguments passed on the stack to the function are accessed by positive offsets from the frame pointer, rbp.</li>
<li>Local variables are accessed by negative offsets from the frame pointer, rbp</li>
</ul>
<p>当离开被调用函数的时候：</p>
<ul>
<li>Place the return value, if any, in eax.</li>
<li>Restore the the values in the rbx, rbp, rsp, and r12 – r15 registers from the register save area in the stack frame.</li>
<li>Delete the local variable space and register save area by copying rbp to rsp.</li>
<li>Restore the caller’s frame pointer by popping rbp off the stack save area.</li>
<li>Return to calling function with ret.</li>
</ul>
<p>补一点内存对齐的内容：</p>
<p>编译器会尽量避免数据被两次读取，因此会积极主动地采用内存对齐的操作进行执行。原则为两条：</p>
<ul>
<li>结构体第一个成员的<strong>偏移量（offset）<strong>为0，以后每个成员相对于结构体首地址的 offset 都是</strong>该成员大小与实际的对齐值	中较小那个</strong>的整数倍，如有需要编译器会在成员之间加上填充字节。</li>
<li><strong>结构体的总大小</strong>为 实际的对齐值 的<strong>整数倍</strong>，如有需要编译器会在最末一个成员之后加上填充字节。</li>
</ul>
<p>换言之，可以说结果是，下面的说法也不是很对：</p>
<ul>
<li>基本类型的对齐值就是其sizeof值</li>
<li>结构体的对齐值是其成员的最大对齐值</li>
<li>编译器可以设置一个对齐值，但是类型的实际对齐值是该类型的对齐值与设定的对齐值取最小值得来。</li>
<li>结构体的成员为数组的时候，计算对齐值是根据数据元素的长度，而不是数组的整体大小</li>
</ul>


<h2 class="relative group">第十二章：位运算，乘法除法 
    <div id="%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%E4%BD%8D%E8%BF%90%E7%AE%97%E4%B9%98%E6%B3%95%E9%99%A4%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%E4%BD%8D%E8%BF%90%E7%AE%97%E4%B9%98%E6%B3%95%E9%99%A4%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">12.1-2 逻辑运算 
    <div id="121-2-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#121-2-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>几条新指令：</p>
<ul>
<li>ands，和原先一致s可以是b,w,l,q</li>
<li>ors，和原先一致s可以是b,w,l,q</li>
<li>xors，和原先一致s可以是b,w,l,q</li>
<li>shrs，和原先一致s可以是b,w,l,q。右移，高位补0，低位，或者说被移除的位拷贝到cf里</li>
<li>sars，和原先一致s可以是b,w,l,q。右移，高位补和原先最高位一样的数字，低位，或者说被移除的位拷贝到cf里</li>
<li>shls，和原先一致s可以是b,w,l,q。左移，低位补0，高位，或者说被移除的位拷贝到cf里</li>
<li>sals，和原先一致s可以是b,w,l,q。左移，低位补0，高位，或者说被移除的位拷贝到cf里</li>
</ul>


<h3 class="relative group">12.3 乘法 
    <div id="123-%E4%B9%98%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#123-%E4%B9%98%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>几条新指令：</p>
<ul>
<li>muls，和原先一致s可以是b,w,l,q。unsigned乘法，目的操作数必须在al,ax,eax,rax寄存器里。C语言里面，认为unsigned模式是循环或者说是reduced modulo的</li>
<li>imuls，和原先一致s可以是b,w,l,q。signed乘法，这个的格式很多，有三种imuls source; imuls source,destination;imuls immediate,source,destination;</li>
</ul>


<h3 class="relative group">12.4 除法 
    <div id="124-%E9%99%A4%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#124-%E9%99%A4%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>几条新指令：</p>
<ul>
<li>divs，和原先一致s可以是b,w,l,q。无符号除法，和muls用的操作数都一样的</li>
<li>idivs，和原先一致s可以是b,w,l,q。有符号除法，和muls用的操作数都一样的。可没有imuls那么花里胡哨的</li>
</ul>


<h3 class="relative group">12.6 取补码 
    <div id="126-%E5%8F%96%E8%A1%A5%E7%A0%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#126-%E5%8F%96%E8%A1%A5%E7%A0%81" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>二进制取补码</p>
<ul>
<li>negs，和原先一致s可以是b,w,l,q。</li>
</ul>


<h2 class="relative group">第十三章：C/C++语言和汇编的转换 
    <div id="%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0cc%E8%AF%AD%E8%A8%80%E5%92%8C%E6%B1%87%E7%BC%96%E7%9A%84%E8%BD%AC%E6%8D%A2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0cc%E8%AF%AD%E8%A8%80%E5%92%8C%E6%B1%87%E7%BC%96%E7%9A%84%E8%BD%AC%E6%8D%A2" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>使用gdb调试的时候，输入layout asm就能一遍调试，一边看asm的代码了</p>


<h3 class="relative group">13.1 部分算数运算的优化和转换 
    <div id="131-%E9%83%A8%E5%88%86%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E7%9A%84%E4%BC%98%E5%8C%96%E5%92%8C%E8%BD%AC%E6%8D%A2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#131-%E9%83%A8%E5%88%86%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E7%9A%84%E4%BC%98%E5%8C%96%E5%92%8C%E8%BD%AC%E6%8D%A2" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">13.1.1 乘法 
    <div id="1311-%E4%B9%98%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#1311-%E4%B9%98%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">13.1.2 除法 
    <div id="1312-%E9%99%A4%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#1312-%E9%99%A4%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h5 class="relative group">13.1.2.1 无符号除法的几种形式 
    <div id="13121-%E6%97%A0%E7%AC%A6%E5%8F%B7%E9%99%A4%E6%B3%95%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#13121-%E6%97%A0%E7%AC%A6%E5%8F%B7%E9%99%A4%E6%B3%95%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>无符号除法的对应的形式主要有三种，1 除数是2的幂次 2</p>
<p>代码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc / 16 = %u&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">argc</span> <span class="o">/</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc / 3 = %u&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">argc</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc / 7 = %u&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">argc</span> <span class="o">/</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>可以看到，针对2的幂次就是直接右移，针对非2的幂次。除法做了相应的优化，计算出来一个魔数，如果魔术小于四字节整数范围那就直接计算，可是如果超过累四字节，那就</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">Dump of assembler code for function main:
   0x000055555555464a &lt;+0&gt;:	push   %rbp
   0x000055555555464b &lt;+1&gt;:	mov    %rsp,%rbp
=&gt; 0x000055555555464e &lt;+4&gt;:	sub    $0x10,%rsp
   0x0000555555554652 &lt;+8&gt;:	mov    %edi,-0x4(%rbp)
   0x0000555555554655 &lt;+11&gt;:	mov    %rsi,-0x10(%rbp)
   0x0000555555554659 &lt;+15&gt;:	mov    -0x4(%rbp),%eax
   0x000055555555465c &lt;+18&gt;:	shr    $0x4,%eax   #对应argc / 16 = %u
   0x000055555555465f &lt;+21&gt;:	mov    %eax,%esi
   0x0000555555554661 &lt;+23&gt;:	lea    0xec(%rip),%rdi        # 0x555555554754
   0x0000555555554668 &lt;+30&gt;:	mov    $0x0,%eax
   0x000055555555466d &lt;+35&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x0000555555554672 &lt;+40&gt;:	mov    -0x4(%rbp),%eax
   0x0000555555554675 &lt;+43&gt;:	mov    $0xaaaaaaab,%edx
   0x000055555555467a &lt;+48&gt;:	mul    %edx      # argc / 3 的核心，虽然是乘法但是右移以后是除法
   0x000055555555467c &lt;+50&gt;:	mov    %edx,%eax
   0x000055555555467e &lt;+52&gt;:	shr    %eax      # short-hand for SAR EAX,1
   0x0000555555554680 &lt;+54&gt;:	mov    %eax,%esi
   0x0000555555554682 &lt;+56&gt;:	lea    0xda(%rip),%rdi        # 0x555555554763
   0x0000555555554689 &lt;+63&gt;:	mov    $0x0,%eax
   0x000055555555468e &lt;+68&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x0000555555554693 &lt;+73&gt;:	mov    -0x4(%rbp),%ecx
   0x0000555555554696 &lt;+76&gt;:	mov    $0x24924925,%edx
   0x000055555555469b &lt;+81&gt;:	mov    %ecx,%eax
   0x000055555555469d &lt;+83&gt;:	mul    %edx
   0x000055555555469f &lt;+85&gt;:	mov    %ecx,%eax
   0x00005555555546a1 &lt;+87&gt;:	sub    %edx,%eax
   0x00005555555546a3 &lt;+89&gt;:	shr    %eax
   0x00005555555546a5 &lt;+91&gt;:	add    %edx,%eax
   0x00005555555546a7 &lt;+93&gt;:	shr    $0x2,%eax
   0x00005555555546aa &lt;+96&gt;:	mov    %eax,%esi
   0x00005555555546ac &lt;+98&gt;:	lea    0xbe(%rip),%rdi        # 0x555555554771
   0x00005555555546b3 &lt;+105&gt;:	mov    $0x0,%eax
   0x00005555555546b8 &lt;+110&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x00005555555546bd &lt;+115&gt;:	mov    $0x0,%eax
   0x00005555555546c2 &lt;+120&gt;:	leaveq
   0x00005555555546c3 &lt;+121&gt;:	retq
End of assembler dump.
</code></pre>

<h5 class="relative group">13.1.2.2 有符号除法除数是正数的几种形式 
    <div id="13122-%E6%9C%89%E7%AC%A6%E5%8F%B7%E9%99%A4%E6%B3%95%E9%99%A4%E6%95%B0%E6%98%AF%E6%AD%A3%E6%95%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#13122-%E6%9C%89%E7%AC%A6%E5%8F%B7%E9%99%A4%E6%B3%95%E9%99%A4%E6%95%B0%E6%98%AF%E6%AD%A3%E6%95%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>对C语言而言，除法规则是向0取整</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argc</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc / 8 = %d&#34;</span><span class="p">,</span> <span class="n">argc</span> <span class="o">/</span> <span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc / 9 = %d&#34;</span><span class="p">,</span> <span class="n">argc</span> <span class="o">/</span> <span class="mi">9</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc / 7 = %d&#34;</span><span class="p">,</span> <span class="n">argc</span> <span class="o">/</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>可以看到对2的幂次的除法</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
   0x000055555555464a &lt;+0&gt;:	push   %rbp
   0x000055555555464b &lt;+1&gt;:	mov    %rsp,%rbp
=&gt; 0x000055555555464e &lt;+4&gt;:	sub    $0x10,%rsp
   0x0000555555554652 &lt;+8&gt;:	mov    %edi,-0x4(%rbp)
   0x0000555555554655 &lt;+11&gt;:	mov    %rsi,-0x10(%rbp)
   0x0000555555554659 &lt;+15&gt;:	mov    -0x4(%rbp),%eax
   0x000055555555465c &lt;+18&gt;:	lea    0x7(%rax),%edx
   0x000055555555465f &lt;+21&gt;:	test   %eax,%eax   # argc / 8
   0x0000555555554661 &lt;+23&gt;:	cmovs  %edx,%eax
   0x0000555555554664 &lt;+26&gt;:	sar    $0x3,%eax
   0x0000555555554667 &lt;+29&gt;:	mov    %eax,%esi
   0x0000555555554669 &lt;+31&gt;:	lea    0xf4(%rip),%rdi        # 0x555555554764
   0x0000555555554670 &lt;+38&gt;:	mov    $0x0,%eax
   0x0000555555554675 &lt;+43&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x000055555555467a &lt;+48&gt;:	mov    -0x4(%rbp),%ecx
   0x000055555555467d &lt;+51&gt;:	mov    $0x38e38e39,%edx # argc / 9
   0x0000555555554682 &lt;+56&gt;:	mov    %ecx,%eax
   0x0000555555554684 &lt;+58&gt;:	imul   %edx
   0x0000555555554686 &lt;+60&gt;:	sar    %edx
   0x0000555555554688 &lt;+62&gt;:	mov    %ecx,%eax
   0x000055555555468a &lt;+64&gt;:	sar    $0x1f,%eax
   0x000055555555468d &lt;+67&gt;:	sub    %eax,%edx
   0x000055555555468f &lt;+69&gt;:	mov    %edx,%eax
   0x0000555555554691 &lt;+71&gt;:	mov    %eax,%esi
   0x0000555555554693 &lt;+73&gt;:	lea    0xd8(%rip),%rdi        # 0x555555554772
   0x000055555555469a &lt;+80&gt;:	mov    $0x0,%eax
   0x000055555555469f &lt;+85&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x00005555555546a4 &lt;+90&gt;:	mov    -0x4(%rbp),%ecx
   0x00005555555546a7 &lt;+93&gt;:	mov    $0x92492493,%edx # argc / 7
   0x00005555555546ac &lt;+98&gt;:	mov    %ecx,%eax
   0x00005555555546ae &lt;+100&gt;:	imul   %edx
   0x00005555555546b0 &lt;+102&gt;:	lea    (%rdx,%rcx,1),%eax
   0x00005555555546b3 &lt;+105&gt;:	sar    $0x2,%eax
   0x00005555555546b6 &lt;+108&gt;:	mov    %eax,%edx
   0x00005555555546b8 &lt;+110&gt;:	mov    %ecx,%eax
   0x00005555555546ba &lt;+112&gt;:	sar    $0x1f,%eax
   0x00005555555546bd &lt;+115&gt;:	sub    %eax,%edx
   0x00005555555546bf &lt;+117&gt;:	mov    %edx,%eax
   0x00005555555546c1 &lt;+119&gt;:	mov    %eax,%esi
   0x00005555555546c3 &lt;+121&gt;:	lea    0xb6(%rip),%rdi        # 0x555555554780
   0x00005555555546ca &lt;+128&gt;:	mov    $0x0,%eax
   0x00005555555546cf &lt;+133&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x00005555555546d4 &lt;+138&gt;:	mov    $0x0,%eax
   0x00005555555546d9 &lt;+143&gt;:	leaveq
   0x00005555555546da &lt;+144&gt;:	retq
End of assembler dump.
(gdb)
</code></pre>

<h5 class="relative group">13.1.2.3 有符号除法除数是负数的几种形式 
    <div id="13123-%E6%9C%89%E7%AC%A6%E5%8F%B7%E9%99%A4%E6%B3%95%E9%99%A4%E6%95%B0%E6%98%AF%E8%B4%9F%E6%95%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#13123-%E6%9C%89%E7%AC%A6%E5%8F%B7%E9%99%A4%E6%B3%95%E9%99%A4%E6%95%B0%E6%98%AF%E8%B4%9F%E6%95%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h5>
<pre tabindex="0"><code>#include &lt;stdio.h&gt;
int main(int argc, char* argv[]) {
  printf(&#34;argc / -4 = %d&#34;, argc / -4);
  printf(&#34;argc / -5 = %d&#34;, argc / -5);
  printf(&#34;argc / -7 = %d&#34;, argc / -7);
  return 0;
}
</code></pre><pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
   0x000055555555464a &lt;+0&gt;:	push   %rbp
   0x000055555555464b &lt;+1&gt;:	mov    %rsp,%rbp
=&gt; 0x000055555555464e &lt;+4&gt;:	sub    $0x10,%rsp
   0x0000555555554652 &lt;+8&gt;:	mov    %edi,-0x4(%rbp)
   0x0000555555554655 &lt;+11&gt;:	mov    %rsi,-0x10(%rbp)
   0x0000555555554659 &lt;+15&gt;:	mov    -0x4(%rbp),%eax
   0x000055555555465c &lt;+18&gt;:	lea    0x3(%rax),%edx
   0x000055555555465f &lt;+21&gt;:	test   %eax,%eax
   0x0000555555554661 &lt;+23&gt;:	cmovs  %edx,%eax
   0x0000555555554664 &lt;+26&gt;:	sar    $0x2,%eax
   0x0000555555554667 &lt;+29&gt;:	neg    %eax
   0x0000555555554669 &lt;+31&gt;:	mov    %eax,%esi
   0x000055555555466b &lt;+33&gt;:	lea    0xf2(%rip),%rdi        # 0x555555554764
   0x0000555555554672 &lt;+40&gt;:	mov    $0x0,%eax
   0x0000555555554677 &lt;+45&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x000055555555467c &lt;+50&gt;:	mov    -0x4(%rbp),%ecx
   0x000055555555467f &lt;+53&gt;:	mov    $0x66666667,%edx
   0x0000555555554684 &lt;+58&gt;:	mov    %ecx,%eax
   0x0000555555554686 &lt;+60&gt;:	imul   %edx
   0x0000555555554688 &lt;+62&gt;:	mov    %edx,%eax
   0x000055555555468a &lt;+64&gt;:	sar    %eax
   0x000055555555468c &lt;+66&gt;:	sar    $0x1f,%ecx
   0x000055555555468f &lt;+69&gt;:	mov    %ecx,%edx
   0x0000555555554691 &lt;+71&gt;:	sub    %eax,%edx
   0x0000555555554693 &lt;+73&gt;:	mov    %edx,%eax
   0x0000555555554695 &lt;+75&gt;:	mov    %eax,%esi
   0x0000555555554697 &lt;+77&gt;:	lea    0xd5(%rip),%rdi        # 0x555555554773
   0x000055555555469e &lt;+84&gt;:	mov    $0x0,%eax
   0x00005555555546a3 &lt;+89&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x00005555555546a8 &lt;+94&gt;:	mov    -0x4(%rbp),%ecx
   0x00005555555546ab &lt;+97&gt;:	mov    $0x92492493,%edx
   0x00005555555546b0 &lt;+102&gt;:	mov    %ecx,%eax
   0x00005555555546b2 &lt;+104&gt;:	imul   %edx
   0x00005555555546b4 &lt;+106&gt;:	lea    (%rdx,%rcx,1),%eax
   0x00005555555546b7 &lt;+109&gt;:	sar    $0x2,%eax
   0x00005555555546ba &lt;+112&gt;:	sar    $0x1f,%ecx
   0x00005555555546bd &lt;+115&gt;:	mov    %ecx,%edx
   0x00005555555546bf &lt;+117&gt;:	sub    %eax,%edx
   0x00005555555546c1 &lt;+119&gt;:	mov    %edx,%eax
   0x00005555555546c3 &lt;+121&gt;:	mov    %eax,%esi
   0x00005555555546c5 &lt;+123&gt;:	lea    0xb6(%rip),%rdi        # 0x555555554782
   0x00005555555546cc &lt;+130&gt;:	mov    $0x0,%eax
   0x00005555555546d1 &lt;+135&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
   0x00005555555546d6 &lt;+140&gt;:	mov    $0x0,%eax
   0x00005555555546db &lt;+145&gt;:	leaveq
   0x00005555555546dc &lt;+146&gt;:	retq
End of assembler dump.
(gdb)
</code></pre>

<h3 class="relative group">13.2 控制流程的汇编 
    <div id="132-%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B%E7%9A%84%E6%B1%87%E7%BC%96" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#132-%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B%E7%9A%84%E6%B1%87%E7%BC%96" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>来看一点控制结构的代码，对于if而言，gcc/clang会考虑启用分支预测，这样子命中的情况下不会触发跳转，而没命中触发两次跳转。下面给了一个多个ifelse对比的例子，可以看出来，多个ifelse的语句，会分别根据跳转的情况走到不同的语句块，比方说if命中跳到A，没命中跳到B</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc &gt; 0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc == 0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;argc &lt;= 0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">Dump of assembler code for function main:
=&gt; 0x0000555555554560 &lt;+0&gt;:	sub    $0x8,%rsp
   0x0000555555554564 &lt;+4&gt;:	cmp    $0x0,%edi
   0x0000555555554567 &lt;+7&gt;:	jg     0x55555555459a &lt;main+58&gt;
   0x0000555555554569 &lt;+9&gt;:	je     0x555555554585 &lt;main+37&gt;
   0x000055555555456b &lt;+11&gt;:	lea    0x1e5(%rip),%rsi        # 0x555555554757
   0x0000555555554572 &lt;+18&gt;:	mov    $0x1,%edi
   0x0000555555554577 &lt;+23&gt;:	xor    %eax,%eax
   0x0000555555554579 &lt;+25&gt;:	callq  0x555555554540 &lt;__printf_chk@plt&gt;
   0x000055555555457e &lt;+30&gt;:	xor    %eax,%eax
   0x0000555555554580 &lt;+32&gt;:	add    $0x8,%rsp
   0x0000555555554584 &lt;+36&gt;:	retq
   0x0000555555554585 &lt;+37&gt;:	lea    0x1c1(%rip),%rsi        # 0x55555555474d
   0x000055555555458c &lt;+44&gt;:	mov    $0x1,%edi
   0x0000555555554591 &lt;+49&gt;:	xor    %eax,%eax
   0x0000555555554593 &lt;+51&gt;:	callq  0x555555554540 &lt;__printf_chk@plt&gt;
   0x0000555555554598 &lt;+56&gt;:	jmp    0x55555555457e &lt;main+30&gt;
   0x000055555555459a &lt;+58&gt;:	lea    0x1a3(%rip),%rsi        # 0x555555554744
   0x00005555555545a1 &lt;+65&gt;:	mov    $0x1,%edi
   0x00005555555545a6 &lt;+70&gt;:	xor    %eax,%eax
   0x00005555555545a8 &lt;+72&gt;:	callq  0x555555554540 &lt;__printf_chk@plt&gt;
   0x00005555555545ad &lt;+77&gt;:	jmp    0x55555555457e &lt;main+30&gt;
End of assembler dump.
</code></pre><p>和多ifelse的跳转不同，尽管也有好多的比较，switch case看起来就是单纯的比较，跳转到对应的语句块。没命中的话就继续做比较，简单来说就是没命中的情况下，不会</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 3&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">100</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 100&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
=&gt; 0x0000555555554610 &lt;+0&gt;:	sub    $0x18,%rsp
   0x0000555555554614 &lt;+4&gt;:	lea    0x229(%rip),%rdi        # 0x555555554844
   0x000055555555461b &lt;+11&gt;:	mov    %fs:0x28,%rax
   0x0000555555554624 &lt;+20&gt;:	mov    %rax,0x8(%rsp)
   0x0000555555554629 &lt;+25&gt;:	xor    %eax,%eax
   0x000055555555462b &lt;+27&gt;:	lea    0x4(%rsp),%rsi
   0x0000555555554630 &lt;+32&gt;:	movl   $0x1,0x4(%rsp)
   0x0000555555554638 &lt;+40&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x000055555555463d &lt;+45&gt;:	mov    0x4(%rsp),%eax
   0x0000555555554641 &lt;+49&gt;:	cmp    $0x3,%eax
   0x0000555555554644 &lt;+52&gt;:	je     0x555555554691 &lt;main+129&gt;
   0x0000555555554646 &lt;+54&gt;:	cmp    $0x64,%eax
   0x0000555555554649 &lt;+57&gt;:	je     0x55555555467c &lt;main+108&gt;
   0x000055555555464b &lt;+59&gt;:	sub    $0x1,%eax
   0x000055555555464e &lt;+62&gt;:	je     0x555555554667 &lt;main+87&gt;
   0x0000555555554650 &lt;+64&gt;:	xor    %eax,%eax
   0x0000555555554652 &lt;+66&gt;:	mov    0x8(%rsp),%rdx
   0x0000555555554657 &lt;+71&gt;:	xor    %fs:0x28,%rdx
   0x0000555555554660 &lt;+80&gt;:	jne    0x5555555546a6 &lt;main+150&gt;
   0x0000555555554662 &lt;+82&gt;:	add    $0x18,%rsp
   0x0000555555554666 &lt;+86&gt;:	retq
   0x0000555555554667 &lt;+87&gt;:	lea    0x1d9(%rip),%rsi        # 0x555555554847
   0x000055555555466e &lt;+94&gt;:	mov    $0x1,%edi
   0x0000555555554673 &lt;+99&gt;:	xor    %eax,%eax
   0x0000555555554675 &lt;+101&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x000055555555467a &lt;+106&gt;:	jmp    0x555555554650 &lt;main+64&gt;
   0x000055555555467c &lt;+108&gt;:	lea    0x1d2(%rip),%rsi        # 0x555555554855
   0x0000555555554683 &lt;+115&gt;:	mov    $0x1,%edi
   0x0000555555554688 &lt;+120&gt;:	xor    %eax,%eax
   0x000055555555468a &lt;+122&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x000055555555468f &lt;+127&gt;:	jmp    0x555555554650 &lt;main+64&gt;
   0x0000555555554691 &lt;+129&gt;:	lea    0x1b6(%rip),%rsi        # 0x55555555484e
   0x0000555555554698 &lt;+136&gt;:	mov    $0x1,%edi
   0x000055555555469d &lt;+141&gt;:	xor    %eax,%eax
   0x000055555555469f &lt;+143&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x00005555555546a4 &lt;+148&gt;:	jmp    0x555555554650 &lt;main+64&gt;
   0x00005555555546a6 &lt;+150&gt;:	callq  0x5555555545d0 &lt;__stack_chk_fail@plt&gt;
End of assembler dump.
</code></pre><p>对于switch的结构不是有序线性，两个case之间的值差别较大的时候，可以通过建立索引表来做优化</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 3&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 4&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 5&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 6&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">255</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;n == 255&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">Dump of assembler code for function main:
=&gt; 0x0000555555554610 &lt;+0&gt;:	sub    $0x18,%rsp
   0x0000555555554614 &lt;+4&gt;:	lea    0x2a9(%rip),%rdi        # 0x5555555548c4
   0x000055555555461b &lt;+11&gt;:	mov    %fs:0x28,%rax
   0x0000555555554624 &lt;+20&gt;:	mov    %rax,0x8(%rsp)
   0x0000555555554629 &lt;+25&gt;:	xor    %eax,%eax
   0x000055555555462b &lt;+27&gt;:	lea    0x4(%rsp),%rsi
   0x0000555555554630 &lt;+32&gt;:	movl   $0x1,0x4(%rsp)
   0x0000555555554638 &lt;+40&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x000055555555463d &lt;+45&gt;:	mov    0x4(%rsp),%eax
   0x0000555555554641 &lt;+49&gt;:	cmp    $0x4,%eax
   0x0000555555554644 &lt;+52&gt;:	je     0x55555555470b &lt;main+251&gt;
   0x000055555555464a &lt;+58&gt;:	jle    0x555555554693 &lt;main+131&gt;
   0x000055555555464c &lt;+60&gt;:	cmp    $0x6,%eax
   0x000055555555464f &lt;+63&gt;:	je     0x5555555546de &lt;main+206&gt;
   0x0000555555554655 &lt;+69&gt;:	jl     0x5555555546c9 &lt;main+185&gt;
   0x0000555555554657 &lt;+71&gt;:	cmp    $0xff,%eax
   0x000055555555465c &lt;+76&gt;:	jne    0x555555554678 &lt;main+104&gt;
   0x000055555555465e &lt;+78&gt;:	lea    0x28c(%rip),%rsi        # 0x5555555548f1
   0x0000555555554665 &lt;+85&gt;:	mov    $0x1,%edi
   0x000055555555466a &lt;+90&gt;:	xor    %eax,%eax
   0x000055555555466c &lt;+92&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x0000555555554671 &lt;+97&gt;:	nopl   0x0(%rax)
   0x0000555555554678 &lt;+104&gt;:	xor    %eax,%eax
   0x000055555555467a &lt;+106&gt;:	mov    0x8(%rsp),%rdx
   0x000055555555467f &lt;+111&gt;:	xor    %fs:0x28,%rdx
   0x0000555555554688 &lt;+120&gt;:	jne    0x555555554723 &lt;main+275&gt;
   0x000055555555468e &lt;+126&gt;:	add    $0x18,%rsp
   0x0000555555554692 &lt;+130&gt;:	retq
   0x0000555555554693 &lt;+131&gt;:	cmp    $0x2,%eax
   0x0000555555554696 &lt;+134&gt;:	je     0x5555555546f3 &lt;main+227&gt;
   0x0000555555554698 &lt;+136&gt;:	jg     0x5555555546b4 &lt;main+164&gt;
   0x000055555555469a &lt;+138&gt;:	sub    $0x1,%eax
   0x000055555555469d &lt;+141&gt;:	jne    0x555555554678 &lt;main+104&gt;
   0x000055555555469f &lt;+143&gt;:	lea    0x221(%rip),%rsi        # 0x5555555548c7
   0x00005555555546a6 &lt;+150&gt;:	mov    $0x1,%edi
   0x00005555555546ab &lt;+155&gt;:	xor    %eax,%eax
   0x00005555555546ad &lt;+157&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x00005555555546b2 &lt;+162&gt;:	jmp    0x555555554678 &lt;main+104&gt;
   0x00005555555546b4 &lt;+164&gt;:	lea    0x21a(%rip),%rsi        # 0x5555555548d5
   0x00005555555546bb &lt;+171&gt;:	mov    $0x1,%edi
   0x00005555555546c0 &lt;+176&gt;:	xor    %eax,%eax
   0x00005555555546c2 &lt;+178&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x00005555555546c7 &lt;+183&gt;:	jmp    0x555555554678 &lt;main+104&gt;
   0x00005555555546c9 &lt;+185&gt;:	lea    0x213(%rip),%rsi        # 0x5555555548e3
   0x00005555555546d0 &lt;+192&gt;:	mov    $0x1,%edi
   0x00005555555546d5 &lt;+197&gt;:	xor    %eax,%eax
   0x00005555555546d7 &lt;+199&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x00005555555546dc &lt;+204&gt;:	jmp    0x555555554678 &lt;main+104&gt;
   0x00005555555546de &lt;+206&gt;:	lea    0x205(%rip),%rsi        # 0x5555555548ea
   0x00005555555546e5 &lt;+213&gt;:	mov    $0x1,%edi
   0x00005555555546ea &lt;+218&gt;:	xor    %eax,%eax
   0x00005555555546ec &lt;+220&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
   0x00005555555546f1 &lt;+225&gt;:	jmp    0x555555554678 &lt;main+104&gt;
   0x00005555555546f3 &lt;+227&gt;:	lea    0x1d4(%rip),%rsi        # 0x5555555548ce
   0x00005555555546fa &lt;+234&gt;:	mov    $0x1,%edi
   0x00005555555546ff &lt;+239&gt;:	xor    %eax,%eax
   0x0000555555554701 &lt;+241&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x0000555555554706 &lt;+246&gt;:	jmpq   0x555555554678 &lt;main+104&gt;
   0x000055555555470b &lt;+251&gt;:	lea    0x1ca(%rip),%rsi        # 0x5555555548dc
   0x0000555555554712 &lt;+258&gt;:	mov    $0x1,%edi
   0x0000555555554717 &lt;+263&gt;:	xor    %eax,%eax
   0x0000555555554719 &lt;+265&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x000055555555471e &lt;+270&gt;:	jmpq   0x555555554678 &lt;main+104&gt;
   0x0000555555554723 &lt;+275&gt;:	callq  0x5555555545d0 &lt;__stack_chk_fail@plt&gt;
End of assembler dump.
</code></pre><p>关于switch还可以使用开启平衡树的结构，来减少比较的次数。</p>
<p>关于循环结构，do while；while do；for，三种循环都有自己的特点，简单来说。在release模式下，do while没什么变化，而while do会先进行一个if的比较跳转，如果可以直接走就直接走，然后转换为while do的结构；至于for结构也是同样的方法，拆出来初始化阶段，然后把内部结构转换为循环。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">sum_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum_i</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">argc</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span> <span class="s">&#34;sum_i is %d&#34;</span><span class="p">,</span> <span class="n">sum_i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">sum_j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">argc</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum_j</span> <span class="o">+=</span> <span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span> <span class="s">&#34;sum_j is %d&#34;</span><span class="p">,</span> <span class="n">sum_j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">sum_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">argc</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum_k</span> <span class="o">+=</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span> <span class="s">&#34;sum_k is %d&#34;</span><span class="p">,</span> <span class="n">sum_k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">Dump of assembler code for function main:
=&gt; 0x0000555555554560 &lt;+0&gt;:	push   %rbx
   0x0000555555554561 &lt;+1&gt;:	xor    %edx,%edx
   0x0000555555554563 &lt;+3&gt;:	mov    %edi,%ebx
   0x0000555555554565 &lt;+5&gt;:	xor    %eax,%eax
   0x0000555555554567 &lt;+7&gt;:	nopw   0x0(%rax,%rax,1)
   0x0000555555554570 &lt;+16&gt;:	add    %eax,%edx
   0x0000555555554572 &lt;+18&gt;:	add    $0x1,%eax
   0x0000555555554575 &lt;+21&gt;:	cmp    %ebx,%eax
   0x0000555555554577 &lt;+23&gt;:	jle    0x555555554570 &lt;main+16&gt;
   0x0000555555554579 &lt;+25&gt;:	lea    0x214(%rip),%rsi        # 0x555555554794
   0x0000555555554580 &lt;+32&gt;:	xor    %eax,%eax
   0x0000555555554582 &lt;+34&gt;:	mov    $0x1,%edi
   0x0000555555554587 &lt;+39&gt;:	callq  0x555555554540 &lt;__printf_chk@plt&gt;
   0x000055555555458c &lt;+44&gt;:	mov    %ebx,%ecx
   0x000055555555458e &lt;+46&gt;:	add    %ecx,%ecx
   0x0000555555554590 &lt;+48&gt;:	js     0x5555555545f0 &lt;main+144&gt;
   0x0000555555554592 &lt;+50&gt;:	add    $0x1,%ecx
   0x0000555555554595 &lt;+53&gt;:	xor    %edx,%edx
   0x0000555555554597 &lt;+55&gt;:	xor    %eax,%eax
   0x0000555555554599 &lt;+57&gt;:	nopl   0x0(%rax)
   0x00005555555545a0 &lt;+64&gt;:	add    %eax,%edx
   0x00005555555545a2 &lt;+66&gt;:	add    $0x1,%eax
   0x00005555555545a5 &lt;+69&gt;:	cmp    %eax,%ecx
   0x00005555555545a7 &lt;+71&gt;:	jne    0x5555555545a0 &lt;main+64&gt;
   0x00005555555545a9 &lt;+73&gt;:	lea    0x1f0(%rip),%rsi        # 0x5555555547a0
   0x00005555555545b0 &lt;+80&gt;:	xor    %eax,%eax
   0x00005555555545b2 &lt;+82&gt;:	mov    $0x1,%edi
   0x00005555555545b7 &lt;+87&gt;:	callq  0x555555554540 &lt;__printf_chk@plt&gt;
   0x00005555555545bc &lt;+92&gt;:	lea    (%rbx,%rbx,2),%ecx
   0x00005555555545bf &lt;+95&gt;:	test   %ecx,%ecx
   0x00005555555545c1 &lt;+97&gt;:	jle    0x5555555545f4 &lt;main+148&gt;
   0x00005555555545c3 &lt;+99&gt;:	xor    %eax,%eax
   0x00005555555545c5 &lt;+101&gt;:	xor    %edx,%edx
   0x00005555555545c7 &lt;+103&gt;:	nopw   0x0(%rax,%rax,1)
   0x00005555555545d0 &lt;+112&gt;:	add    %eax,%edx
   0x00005555555545d2 &lt;+114&gt;:	add    $0x1,%eax
   0x00005555555545d5 &lt;+117&gt;:	cmp    %eax,%ecx
   0x00005555555545d7 &lt;+119&gt;:	jne    0x5555555545d0 &lt;main+112&gt;
   0x00005555555545d9 &lt;+121&gt;:	lea    0x1cc(%rip),%rsi        # 0x5555555547ac
   0x00005555555545e0 &lt;+128&gt;:	mov    $0x1,%edi
   0x00005555555545e5 &lt;+133&gt;:	xor    %eax,%eax
   0x00005555555545e7 &lt;+135&gt;:	callq  0x555555554540 &lt;__printf_chk@plt&gt;
   0x00005555555545ec &lt;+140&gt;:	xor    %eax,%eax
   0x00005555555545ee &lt;+142&gt;:	pop    %rbx
   0x00005555555545ef &lt;+143&gt;:	retq
   0x00005555555545f0 &lt;+144&gt;:	xor    %edx,%edx
   0x00005555555545f2 &lt;+146&gt;:	jmp    0x5555555545a9 &lt;main+73&gt;
   0x00005555555545f4 &lt;+148&gt;:	xor    %edx,%edx
   0x00005555555545f6 &lt;+150&gt;:	jmp    0x5555555545d9 &lt;main+121&gt;
End of assembler dump.
(gdb)
</code></pre>

<h3 class="relative group">13.3 函数的工作原理 
    <div id="133-%E5%87%BD%E6%95%B0%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#133-%E5%87%BD%E6%95%B0%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>函数是分析的重点，C/C++里面，函数参数传参顺序为从右向左一次入栈，最先定义参数最后入栈。对于C++有三种调用约定，但是对于X64只有一种，即cdicl，另外Integer arguments are passed in registers RCX, RDX, R8, and R9. Floating point arguments are passed in XMM0L, XMM1L, XMM2L, and XMM3L. 16-byte arguments are passed by reference. Parameter passing is described in detail in <a href="https://docs.microsoft.com/en-us/cpp/build/x64-calling-convention?view=msvc-170#parameter-passing" target="_blank">Parameter passing</a>. These registers, and RAX, R10, R11, XMM4, and XMM5, are considered <em>volatile</em>, or potentially changed by a callee on return. Register usage is documented in detail in <a href="https://docs.microsoft.com/en-us/cpp/build/x64-software-conventions?view=msvc-170#x64-register-usage" target="_blank">x64 register usage</a> and <a href="https://docs.microsoft.com/en-us/cpp/build/x64-calling-convention?view=msvc-170#callercallee-saved-registers" target="_blank">Caller/callee saved registers</a>.</p>
<ul>
<li>cdicl: The parameters are pushed from right to left (so that the first parameter is nearest to top-of-stack), and the caller cleans the parameters. Function names are decorated by a leading underscore.</li>
<li><del>stdcall: This is the calling convention used for Win32, with exceptions for variadic functions (which necessarily use __cdecl) and a very few functions that use __fastcall. Parameters are pushed from right to left [<em>corrected 10:18am</em>] and the callee cleans the stack. Function names are decorated by a leading underscore and a trailing @-sign followed by the number of bytes of parameters taken by the function.</del></li>
<li><del>fatstcall:The first two parameters are passed in ECX and EDX, with the remainder passed on the stack as in __stdcall. Again, the callee cleans the stack. Function names are decorated by a leading @-sign and a trailing @-sign followed by the number of bytes of parameters taken by the function (including the register parameters).</del></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">addNumber</span><span class="p">(</span><span class="kt">int</span> <span class="n">n1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">n1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">n1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">addNumber</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
=&gt; 0x0000555555554610 &lt;+0&gt;:	sub    $0x18,%rsp
   0x0000555555554614 &lt;+4&gt;:	lea    0x21d(%rip),%rdi        # 0x555555554838
   0x000055555555461b &lt;+11&gt;:	mov    %fs:0x28,%rax
   0x0000555555554624 &lt;+20&gt;:	mov    %rax,0x8(%rsp)
   0x0000555555554629 &lt;+25&gt;:	xor    %eax,%eax
   0x000055555555462b &lt;+27&gt;:	lea    0x4(%rsp),%rsi
   0x0000555555554630 &lt;+32&gt;:	movl   $0x0,0x4(%rsp)
   0x0000555555554638 &lt;+40&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x000055555555463d &lt;+45&gt;:	mov    0x4(%rsp),%eax
   0x0000555555554641 &lt;+49&gt;:	lea    0x1ec(%rip),%rsi        # 0x555555554834
   0x0000555555554648 &lt;+56&gt;:	mov    $0x1,%edi
   0x000055555555464d &lt;+61&gt;:	lea    0x1(%rax),%edx
   0x0000555555554650 &lt;+64&gt;:	xor    %eax,%eax
   0x0000555555554652 &lt;+66&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x0000555555554657 &lt;+71&gt;:	mov    0x8(%rsp),%rcx
   0x000055555555465c &lt;+76&gt;:	xor    %fs:0x28,%rcx
   0x0000555555554665 &lt;+85&gt;:	jne    0x55555555466e &lt;main+94&gt;
   0x0000555555554667 &lt;+87&gt;:	xor    %eax,%eax
   0x0000555555554669 &lt;+89&gt;:	add    $0x18,%rsp
   0x000055555555466d &lt;+93&gt;:	retq
   0x000055555555466e &lt;+94&gt;:	callq  0x5555555545d0 &lt;__stack_chk_fail@plt&gt;
End of assembler dump.
(gdb)
</code></pre><p>再看一个例子</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%c&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d %c</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">n</span> <span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
=&gt; 0x0000555555554610 &lt;+0&gt;:	sub    $0x18,%rsp
   0x0000555555554614 &lt;+4&gt;:	lea    0x209(%rip),%rdi        # 0x555555554824
   0x000055555555461b &lt;+11&gt;:	mov    %fs:0x28,%rax
   0x0000555555554624 &lt;+20&gt;:	mov    %rax,0x8(%rsp)
   0x0000555555554629 &lt;+25&gt;:	xor    %eax,%eax
   0x000055555555462b &lt;+27&gt;:	lea    0x4(%rsp),%rsi
   0x0000555555554630 &lt;+32&gt;:	movl   $0x0,0x4(%rsp)
   0x0000555555554638 &lt;+40&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x000055555555463d &lt;+45&gt;:	lea    0x3(%rsp),%rsi
   0x0000555555554642 &lt;+50&gt;:	lea    0x1de(%rip),%rdi        # 0x555555554827
   0x0000555555554649 &lt;+57&gt;:	xor    %eax,%eax
   0x000055555555464b &lt;+59&gt;:	movb   $0x2,0x3(%rsp)
   0x0000555555554650 &lt;+64&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x0000555555554655 &lt;+69&gt;:	movsbl 0x3(%rsp),%ecx
   0x000055555555465a &lt;+74&gt;:	mov    0x4(%rsp),%edx
   0x000055555555465e &lt;+78&gt;:	lea    0x1c5(%rip),%rsi        # 0x55555555482a
   0x0000555555554665 &lt;+85&gt;:	xor    %eax,%eax
   0x0000555555554667 &lt;+87&gt;:	mov    $0x1,%edi
   0x000055555555466c &lt;+92&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x0000555555554671 &lt;+97&gt;:	mov    0x8(%rsp),%rdx
   0x0000555555554676 &lt;+102&gt;:	xor    %fs:0x28,%rdx
   0x000055555555467f &lt;+111&gt;:	jne    0x555555554688 &lt;main+120&gt;
   0x0000555555554681 &lt;+113&gt;:	xor    %eax,%eax
   0x0000555555554683 &lt;+115&gt;:	add    $0x18,%rsp
   0x0000555555554687 &lt;+119&gt;:	retq
   0x0000555555554688 &lt;+120&gt;:	callq  0x5555555545d0 &lt;__stack_chk_fail@plt&gt;
End of assembler dump.
(gdb)
</code></pre><p>X64的调用约定，有两种：</p>
<ul>
<li>
<p>Microsoft x64 calling convention：The Microsoft x64 calling convention[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-ms-18" target="_blank">18]</a>[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-19" target="_blank">19]</a> is followed on <a href="https://en.wikipedia.org/wiki/Windows_%28operating_system%29" target="_blank">Windows</a> and pre-boot <a href="https://en.wikipedia.org/wiki/UEFI" target="_blank">UEFI</a> (for <a href="https://en.wikipedia.org/wiki/Long_mode" target="_blank">long mode</a> on <a href="https://en.wikipedia.org/wiki/X86-64" target="_blank">x86-64</a>). The first four arguments are placed onto the registers. That means RCX, RDX, R8, R9 for integer, struct or pointer arguments (in that order), and XMM0, XMM1, XMM2, XMM3 for floating point arguments. Additional arguments are pushed onto the stack (right to left). Integer return values (similar to x86) are returned in RAX if 64 bits or less. Floating point return values are returned in XMM0. Parameters less than 64 bits long are not zero extended; the high bits are not zeroed.</p>
<p>Structs and unions with sizes that match integers are passed and returned as if they were integers. Otherwise they are replaced with a pointer when used as an argument. When an oversized struct return is needed, another pointer to a caller-provided space is prepended as the first argument, shifting all other arguments to the right by one place.[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-20" target="_blank">20]</a></p>
<p>When compiling for the x64 architecture in a Windows context (whether using Microsoft or non-Microsoft tools), stdcall, thiscall, cdecl, and fastcall all resolve to using this convention.</p>
<p>In the Microsoft x64 calling convention, it is the caller&rsquo;s responsibility to allocate 32 bytes of &ldquo;shadow space&rdquo; on the stack right before calling the function (regardless of the actual number of parameters used), and to pop the stack after the call. The shadow space is used to spill RCX, RDX, R8, and R9,[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-21" target="_blank">21]</a> but must be made available to all functions, even those with fewer than four parameters.</p>
<p>The registers RAX, RCX, RDX, R8, R9, R10, R11 are considered volatile (caller-saved).[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-Caller/Callee_Saved_Registers-22" target="_blank">22]</a></p>
<p>The registers RBX, RBP, RDI, RSI, RSP, R12, R13, R14, and R15 are considered nonvolatile (callee-saved).[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-Caller/Callee_Saved_Registers-22" target="_blank">22]</a></p>
<p>For example, a function taking 5 integer arguments will take the first to fourth in registers, and the fifth will be pushed on top of the shadow space. So when the called function is entered, the stack will be composed of (in ascending order) the return address, followed by the shadow space (32 bytes) followed by the fifth parameter.</p>
<p>In <a href="https://en.wikipedia.org/wiki/X86-64" target="_blank">x86-64</a>, Visual Studio 2008 stores floating point numbers in XMM6 and XMM7 (as well as XMM8 through XMM15); consequently, for <a href="https://en.wikipedia.org/wiki/X86-64" target="_blank">x86-64</a>, user-written assembly language routines must preserve XMM6 and XMM7 (as compared to <a href="https://en.wikipedia.org/wiki/X86" target="_blank">x86</a> wherein user-written assembly language routines did not need to preserve XMM6 and XMM7). In other words, user-written assembly language routines must be updated to save/restore XMM6 and XMM7 before/after the function when being ported from <a href="https://en.wikipedia.org/wiki/X86" target="_blank">x86</a> to <a href="https://en.wikipedia.org/wiki/X86-64" target="_blank">x86-64</a>.</p>
<p>Starting with Visual Studio 2013, Microsoft introduced the <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#Microsoft_vectorcall" target="_blank">__vectorcall</a> calling convention which extends the x64 convention.</p>
</li>
<li>
<p>System V AMD64 ABI：The calling convention of the <a href="https://en.wikipedia.org/wiki/UNIX_System_V" target="_blank">System V</a> AMD64 <a href="https://en.wikipedia.org/wiki/Application_binary_interface" target="_blank">ABI</a> is followed on <a href="https://en.wikipedia.org/wiki/Solaris_%28operating_system%29" target="_blank">Solaris</a>, <a href="https://en.wikipedia.org/wiki/Linux" target="_blank">Linux</a>, <a href="https://en.wikipedia.org/wiki/FreeBSD" target="_blank">FreeBSD</a>, <a href="https://en.wikipedia.org/wiki/MacOS" target="_blank">macOS</a>,[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-OS_X-23" target="_blank">23]</a> and is the de facto standard among Unix and Unix-like operating systems. The <a href="https://en.wikipedia.org/wiki/OpenVMS" target="_blank">OpenVMS</a> Calling Standard on x86-64 is based on the System V ABI with some extensions needed for backwards compatibility.[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-24" target="_blank">24]</a> The first six integer or pointer arguments are passed in registers RDI, RSI, RDX, RCX, R8, R9 (R10 is used as a static chain pointer in case of nested functions[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25" target="_blank">25]</a>: 21 ), while XMM0, XMM1, XMM2, XMM3, XMM4, XMM5, XMM6 and XMM7 are used for the first floating point arguments.[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25" target="_blank">25]</a>: 22  As in the Microsoft x64 calling convention, additional arguments are passed on the stack.[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25" target="_blank">25]</a>: 22  Integer return values up to 64 bits in size are stored in RAX while values up to 128 bit are stored in RAX and RDX. Floating-point return values are similarly stored in XMM0 and XMM1.[[25]](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25): 25  The wider YMM and ZMM registers are used for passing and returning wider values in place of XMM when they exist.[[25]](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25): 26, 55 </p>
<p>If the callee wishes to use registers RBX, RSP, RBP, and R12–R15, it must restore their original values before returning control to the caller. All other registers must be saved by the caller if it wishes to preserve their values.[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25" target="_blank">25]</a>: 16 </p>
<p>For leaf-node functions (functions which do not call any other function(s)), a 128-byte space is stored just beneath the stack pointer of the function. The space is called the <strong><a href="https://en.wikipedia.org/wiki/Red_zone_%28computing%29" target="_blank">red zone</a></strong>. This zone will not be clobbered by any signal or interrupt handlers. Compilers can thus utilize this zone to save local variables. Compilers may omit some instructions at the starting of the function (adjustment of RSP, RBP) by utilizing this zone. However, other functions may clobber this zone. Therefore, this zone should only be used for leaf-node functions. <code>gcc</code> and <code>clang</code> offer the <code>-mno-red-zone</code> flag to disable red-zone optimizations.</p>
<p>If the callee is a <a href="https://en.wikipedia.org/wiki/Variadic_function" target="_blank">variadic function</a>, then the number of floating point arguments passed to the function in vector registers must be provided by the caller in the AL register.[<a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-25" target="_blank">25]</a>: 55 </p>
<p>Unlike the Microsoft calling convention, a shadow space is not provided; on function entry, the return address is adjacent to the seventh integer argument on the stack.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/system_v_hu_c11a888c5bbde05a.png 330w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/system_v_hu_ad1aecdda408d77c.png 660w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/system_v_hu_58f24c3848b93d70.png 1024w,
        /posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/system_v_hu_84e232b346cb4657.png 2x"
        data-zoom-src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/system_v_hu_84e232b346cb4657.png"
        src="/posts/2021-01-31-%E6%B1%87%E7%BC%96%E7%AC%94%E8%AE%B0/imgs/system_v_hu_ad1aecdda408d77c.png"
        alt="image-20220727004238104"
      />
      
    </figure>
</p>
</li>
</ul>


<h3 class="relative group">13.4 变量在内存中的位置和访问方式 
    <div id="134-%E5%8F%98%E9%87%8F%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#134-%E5%8F%98%E9%87%8F%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>变量有很多种，一种一种看：</p>
<ul>
<li>全局变量：在编译链接的时候就确定变量的位置，运行的时候直接使用全局变量的地址进行访问。</li>
<li>全局静态变量：全局静态变量和全局变量是一样的</li>
<li>局部静态变量：局部静态变量和全局静态变量本质没区别，其生命周期和全局变量一样子的，不过有一个地方不一样就是怎么保证只初始化一次呢？实际上是局部静态变量会有一个flag来控制是不是检查过。</li>
<li>堆变量：堆变量是最简单也是最直接的变量了</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">g_global</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">showStatic</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">int</span> <span class="n">g_static</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">g_static</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">showStatic</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">g_global</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">g_global</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
=&gt; 0x0000555555554690 &lt;+0&gt;:	sub    $0x8,%rsp
   0x0000555555554694 &lt;+4&gt;:	xor    %edi,%edi
   0x0000555555554696 &lt;+6&gt;:	callq  0x555555554810 &lt;_Z10showStatici&gt;
   0x000055555555469b &lt;+11&gt;:	mov    $0x1,%edi
   0x00005555555546a0 &lt;+16&gt;:	callq  0x555555554810 &lt;_Z10showStatici&gt;
   0x00005555555546a5 &lt;+21&gt;:	mov    $0x2,%edi
   0x00005555555546aa &lt;+26&gt;:	callq  0x555555554810 &lt;_Z10showStatici&gt;
   0x00005555555546af &lt;+31&gt;:	mov    $0x3,%edi
   0x00005555555546b4 &lt;+36&gt;:	callq  0x555555554810 &lt;_Z10showStatici&gt;
   0x00005555555546b9 &lt;+41&gt;:	mov    $0x4,%edi
   0x00005555555546be &lt;+46&gt;:	callq  0x555555554810 &lt;_Z10showStatici&gt;
   0x00005555555546c3 &lt;+51&gt;:	lea    0x200946(%rip),%rsi        # 0x555555755010 &lt;g_global&gt;
   0x00005555555546ca &lt;+58&gt;:	lea    0x227(%rip),%rdi        # 0x5555555548f8
   0x00005555555546d1 &lt;+65&gt;:	xor    %eax,%eax
   0x00005555555546d3 &lt;+67&gt;:	callq  0x555555554660 &lt;scanf@plt&gt;
   0x00005555555546d8 &lt;+72&gt;:	mov    0x200932(%rip),%edx        # 0x555555755010 &lt;g_global&gt;
   0x00005555555546de &lt;+78&gt;:	lea    0x213(%rip),%rsi        # 0x5555555548f8
   0x00005555555546e5 &lt;+85&gt;:	mov    $0x1,%edi
   0x00005555555546ea &lt;+90&gt;:	xor    %eax,%eax
   0x00005555555546ec &lt;+92&gt;:	callq  0x555555554640 &lt;__printf_chk@plt&gt;
   0x00005555555546f1 &lt;+97&gt;:	xor    %eax,%eax
   0x00005555555546f3 &lt;+99&gt;:	add    $0x8,%rsp
   0x00005555555546f7 &lt;+103&gt;:	retq
End of assembler dump.
(gdb) ni
0x0000555555554694 in main ()
(gdb) ni
0x0000555555554696 in main ()
(gdb) si
0x0000555555554810 in showStatic(int) ()
(gdb) disass
Dump of assembler code for function _Z10showStatici:
=&gt; 0x0000555555554810 &lt;+0&gt;:	push   %rbx
   0x0000555555554811 &lt;+1&gt;:	movzbl 0x200808(%rip),%eax        # 0x555555755020 &lt;_ZGVZ10showStaticiE8g_static&gt;
   0x0000555555554818 &lt;+8&gt;:	test   %al,%al
   0x000055555555481a &lt;+10&gt;:	je     0x555555554840 &lt;_Z10showStatici+48&gt;
   0x000055555555481c &lt;+12&gt;:	mov    0x200806(%rip),%ebx        # 0x555555755028 &lt;_ZZ10showStaticiE8g_static&gt;
   0x0000555555554822 &lt;+18&gt;:	mov    %ebx,%edx
   0x0000555555554824 &lt;+20&gt;:	lea    0xc9(%rip),%rsi        # 0x5555555548f4
   0x000055555555482b &lt;+27&gt;:	mov    $0x1,%edi
   0x0000555555554830 &lt;+32&gt;:	pop    %rbx
   0x0000555555554831 &lt;+33&gt;:	xor    %eax,%eax
   0x0000555555554833 &lt;+35&gt;:	jmpq   0x555555554640 &lt;__printf_chk@plt&gt;
   0x0000555555554838 &lt;+40&gt;:	nopl   0x0(%rax,%rax,1)
   0x0000555555554840 &lt;+48&gt;:	mov    %edi,%ebx
   0x0000555555554842 &lt;+50&gt;:	lea    0x2007d7(%rip),%rdi        # 0x555555755020 &lt;_ZGVZ10showStaticiE8g_static&gt;
   0x0000555555554849 &lt;+57&gt;:	callq  0x555555554670 &lt;__cxa_guard_acquire@plt&gt;
   0x000055555555484e &lt;+62&gt;:	test   %eax,%eax
   0x0000555555554850 &lt;+64&gt;:	je     0x55555555481c &lt;_Z10showStatici+12&gt;
   0x0000555555554852 &lt;+66&gt;:	lea    0x2007c7(%rip),%rdi        # 0x555555755020 &lt;_ZGVZ10showStaticiE8g_static&gt;
   0x0000555555554859 &lt;+73&gt;:	mov    %ebx,0x2007c9(%rip)        # 0x555555755028 &lt;_ZZ10showStaticiE8g_static&gt;
   0x000055555555485f &lt;+79&gt;:	callq  0x555555554650 &lt;__cxa_guard_release@plt&gt;
   0x0000555555554864 &lt;+84&gt;:	jmp    0x555555554822 &lt;_Z10showStatici+18&gt;
End of assembler dump.
</code></pre>

<h3 class="relative group">13.5 结构体和类 
    <div id="135-%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E7%B1%BB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#135-%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E7%B1%BB" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>C++中的类有各种函数，比方说private/public/protected等，但这些实际上都是编译的时候追究的选项，等到成了汇编的时候就和结构体没什么区别了。这时候有个问题，对象长度应该这么计算呢？这时候有下面三个方面要考虑，除此之外还有就是对象是不是处于全局区等多方面因素</p>
<ul>
<li>空类：空类没有数据成员，但可以有函数成员，如果没长度那么没发初始化this指针，其长度为1字节。</li>
<li>内存对齐：实际上有内存对齐的时候这个规则上面就有，具体得看实现编译器的文档了</li>
<li>静态数据成员：静态数据成员实际上是</li>
</ul>
<p>我们通过下面的例子重点看以下几点：</p>
<ul>
<li>this指针是这么传递和调用的，这点我们看persion的setage函数，通过这个例子我们能明白</li>
<li>结构体作为参数是怎么传递的，我们能够发现对于短的结构体，会直接利用压栈手段把数据结构搞进去，对于长的数据结构会采用数据复制的手段。这里面还有一点要注意，我们的代码里面是没有复制构造函数和移动构造函数的，</li>
<li>结构体作为函数的返回值是这么传递的，编译器会先在栈里面申请出来返回对象的内存空间，然后调用返回对象的函数，该函数会将返回的结构体的内容复制到申请的内存空间，再将对象复制给目标对象。这里面有一个C++生命周期的小坑，为什么临时内存空间要在调用方的帧栈里面呢？想这个情况getPersion().count，如果这个不在调用方里面申请内存，那么这时候这个对象的内存明显就被释放了。这也是为什么C++里面搞出来move语句的原因。这里面还有一点，当对象作为返回值，如果该对象是个局部变量，那么不能返回该对象的首地址或者引用（实际上引用这里就是指针）</li>
</ul>
<p>这里面有个地方可能会很有意思，编译器要是上了O2优化可能代码不会有那么明显的调用了，看下面的例子，直接就把对象压扁成了普通对象，然后所有的操作都直接对外表现了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Persion</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="n">setAge</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="nf">showPersion</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;age = %d, height = %d&#34;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">height</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">Persion</span> <span class="n">persion1</span><span class="p">,</span> <span class="n">Persion</span> <span class="n">persion2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;persion 1 age = %d, persion 2 height = %d&#34;</span><span class="p">,</span><span class="n">persion1</span><span class="p">.</span><span class="n">age</span><span class="p">,</span> <span class="n">persion2</span><span class="p">.</span><span class="n">height</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Persion</span> <span class="nf">getPersoin</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">persion_age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">persion_age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">180</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">persion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">persion_age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion1</span><span class="p">.</span><span class="n">setAge</span><span class="p">(</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 		<span class="c1">// 这里的printf的rdi是参数的个数，第二个参数是&#34;Persion : %d \n&#34;放在了esi里面，然后直接压扁了，可以看到直接就是拿出来
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Persion : %d </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">persion1</span><span class="p">.</span><span class="n">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  	<span class="c1">// 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Persion</span> <span class="n">persion2</span> <span class="o">=</span> <span class="n">getPersoin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">show</span><span class="p">(</span><span class="n">persion1</span><span class="p">,</span> <span class="n">persion2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion1</span><span class="p">.</span><span class="n">showPersion</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion2</span><span class="p">.</span><span class="n">showPersion</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">Dump of assembler code for function main:
   0x0000555555554610 &lt;+0&gt;:	push   %rbp
   0x0000555555554611 &lt;+1&gt;:	push   %rbx
   0x0000555555554612 &lt;+2&gt;:	lea    0x331(%rip),%rdi        # 0x55555555494a
   0x0000555555554619 &lt;+9&gt;:	sub    $0x18,%rsp
   0x000055555555461d &lt;+13&gt;:	mov    %fs:0x28,%rax
=&gt; 0x0000555555554626 &lt;+22&gt;:	mov    %rax,0x8(%rsp)
   0x000055555555462b &lt;+27&gt;:	xor    %eax,%eax
   0x000055555555462d &lt;+29&gt;:	mov    %rsp,%rsi
   0x0000555555554630 &lt;+32&gt;:	movl   $0x0,(%rsp)
   0x0000555555554637 &lt;+39&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x000055555555463c &lt;+44&gt;:	mov    (%rsp),%ebx
   0x000055555555463f &lt;+47&gt;:	lea    0x2e2(%rip),%rsi        # 0x555555554928
   0x0000555555554646 &lt;+54&gt;:	mov    $0x1,%edi
   0x000055555555464b &lt;+59&gt;:	xor    %eax,%eax
   0x000055555555464d &lt;+61&gt;:	mov    %ebx,%edx
   0x000055555555464f &lt;+63&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x0000555555554654 &lt;+68&gt;:	lea    0x4(%rsp),%rsi
   0x0000555555554659 &lt;+73&gt;:	lea    0x2ea(%rip),%rdi        # 0x55555555494a
   0x0000555555554660 &lt;+80&gt;:	xor    %eax,%eax
   0x0000555555554662 &lt;+82&gt;:	movl   $0x0,0x4(%rsp)
   0x000055555555466a &lt;+90&gt;:	callq  0x5555555545f0 &lt;scanf@plt&gt;
   0x000055555555466f &lt;+95&gt;:	lea    0x282(%rip),%rsi        # 0x5555555548f8
   0x0000555555554676 &lt;+102&gt;:	mov    $0xb4,%ecx
   0x000055555555467b &lt;+107&gt;:	mov    %ebx,%edx
   0x000055555555467d &lt;+109&gt;:	mov    $0x1,%edi
   0x0000555555554682 &lt;+114&gt;:	xor    %eax,%eax
   0x0000555555554684 &lt;+116&gt;:	mov    0x4(%rsp),%ebp
   0x0000555555554688 &lt;+120&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x000055555555468d &lt;+125&gt;:	lea    0x2a3(%rip),%rsi        # 0x555555554937
   0x0000555555554694 &lt;+132&gt;:	xor    %ecx,%ecx
   0x0000555555554696 &lt;+134&gt;:	mov    %ebx,%edx
   0x0000555555554698 &lt;+136&gt;:	mov    $0x1,%edi
   0x000055555555469d &lt;+141&gt;:	xor    %eax,%eax
   0x000055555555469f &lt;+143&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x00005555555546a4 &lt;+148&gt;:	lea    0x28c(%rip),%rsi        # 0x555555554937
   0x00005555555546ab &lt;+155&gt;:	mov    %ebp,%edx
   0x00005555555546ad &lt;+157&gt;:	xor    %eax,%eax
   0x00005555555546af &lt;+159&gt;:	mov    $0xb4,%ecx
   0x00005555555546b4 &lt;+164&gt;:	mov    $0x1,%edi
   0x00005555555546b9 &lt;+169&gt;:	callq  0x5555555545e0 &lt;__printf_chk@plt&gt;
   0x00005555555546be &lt;+174&gt;:	mov    0x8(%rsp),%rdx
   0x00005555555546c3 &lt;+179&gt;:	xor    %fs:0x28,%rdx
   0x00005555555546cc &lt;+188&gt;:	jne    0x5555555546d7 &lt;main+199&gt;
   0x00005555555546ce &lt;+190&gt;:	add    $0x18,%rsp
   0x00005555555546d2 &lt;+194&gt;:	xor    %eax,%eax
   0x00005555555546d4 &lt;+196&gt;:	pop    %rbx
   0x00005555555546d5 &lt;+197&gt;:	pop    %rbp
   0x00005555555546d6 &lt;+198&gt;:	retq
   0x00005555555546d7 &lt;+199&gt;:	callq  0x5555555545d0 &lt;__stack_chk_fail@plt&gt;
End of assembler dump.
</code></pre><p>我们来看一个简单版本的，sizeof string = 32，这里面实际上有个点可能需要注意到就是string的结构到底是什么？</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">basic_string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span><span class="o">*</span> <span class="n">begin_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">size_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">union</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">size_t</span> <span class="n">capacity_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">sso_buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Persion</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="n">setAge</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">age_</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="nf">getAge</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="nf">setName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="nf">showPersion</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;age = %d, height = %d&#34;</span><span class="p">,</span> <span class="n">age_</span><span class="p">,</span> <span class="n">height_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span><span class="s">&#34; persion name is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">height_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Persion</span> <span class="nf">getPersoin</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">persion_age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">setAge</span><span class="p">(</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">commonName</span><span class="o">=</span><span class="s">&#34;hello,world&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="n">commonName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">persion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion</span> <span class="o">=</span> <span class="n">getPersoin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">showPersion</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">(gdb) disass
Dump of assembler code for function main:
=&gt; 0x0000555555554b70 &lt;+0&gt;:	push   %rbp
   0x0000555555554b71 &lt;+1&gt;:	push   %rbx
   0x0000555555554b72 &lt;+2&gt;:	sub    $0x38,%rsp
   0x0000555555554b76 &lt;+6&gt;:	mov    %rsp,%rbx
   0x0000555555554b79 &lt;+9&gt;:	mov    %rbx,%rdi
   0x0000555555554b7c &lt;+12&gt;:	mov    %fs:0x28,%rax
   0x0000555555554b85 &lt;+21&gt;:	mov    %rax,0x28(%rsp)
   0x0000555555554b8a &lt;+26&gt;:	xor    %eax,%eax
   0x0000555555554b8c &lt;+28&gt;:	callq  0x555555554e40 &lt;_Z10getPersoinv&gt;
   0x0000555555554b91 &lt;+33&gt;:	mov    0x4(%rsp),%ecx
   0x0000555555554b95 &lt;+37&gt;:	mov    (%rsp),%edx
   0x0000555555554b98 &lt;+40&gt;:	lea    0x4a5(%rip),%rsi        # 0x555555555044
   0x0000555555554b9f &lt;+47&gt;:	mov    $0x1,%edi
   0x0000555555554ba4 &lt;+52&gt;:	xor    %eax,%eax
   0x0000555555554ba6 &lt;+54&gt;:	callq  0x555555554aa0 &lt;__printf_chk@plt&gt;
   0x0000555555554bab &lt;+59&gt;:	lea    0x4a8(%rip),%rsi        # 0x55555555505a
   0x0000555555554bb2 &lt;+66&gt;:	lea    0x201467(%rip),%rdi        # 0x555555756020 &lt;_ZSt4cout@@GLIBCXX_3.4&gt;
   0x0000555555554bb9 &lt;+73&gt;:	mov    $0x11,%edx
   0x0000555555554bbe &lt;+78&gt;:	callq  0x555555554b10 &lt;_ZSt16__ostream_insertIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_PKS3_l@plt&gt;
   0x0000555555554bc3 &lt;+83&gt;:	mov    0x10(%rsp),%rdx
   0x0000555555554bc8 &lt;+88&gt;:	mov    0x8(%rsp),%rsi
   0x0000555555554bcd &lt;+93&gt;:	lea    0x20144c(%rip),%rdi        # 0x555555756020 &lt;_ZSt4cout@@GLIBCXX_3.4&gt;
   0x0000555555554bd4 &lt;+100&gt;:	callq  0x555555554b10 &lt;_ZSt16__ostream_insertIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_PKS3_l@plt&gt;
   0x0000555555554bd9 &lt;+105&gt;:	mov    0x8(%rsp),%rdi
   0x0000555555554bde &lt;+110&gt;:	add    $0x18,%rbx
   0x0000555555554be2 &lt;+114&gt;:	cmp    %rbx,%rdi
   0x0000555555554be5 &lt;+117&gt;:	je     0x555555554bec &lt;main+124&gt;
   0x0000555555554be7 &lt;+119&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554bec &lt;+124&gt;:	xor    %eax,%eax
   0x0000555555554bee &lt;+126&gt;:	mov    0x28(%rsp),%rcx
   0x0000555555554bf3 &lt;+131&gt;:	xor    %fs:0x28,%rcx
   0x0000555555554bfc &lt;+140&gt;:	jne    0x555555554c05 &lt;main+149&gt;
   0x0000555555554bfe &lt;+142&gt;:	add    $0x38,%rsp
   0x0000555555554c02 &lt;+146&gt;:	pop    %rbx
   0x0000555555554c03 &lt;+147&gt;:	pop    %rbp
   0x0000555555554c04 &lt;+148&gt;:	retq
   0x0000555555554c05 &lt;+149&gt;:	callq  0x555555554b00 &lt;__stack_chk_fail@plt&gt;
   0x0000555555554c0a &lt;+154&gt;:	mov    0x8(%rsp),%rdi
   0x0000555555554c0f &lt;+159&gt;:	add    $0x18,%rbx
   0x0000555555554c13 &lt;+163&gt;:	mov    %rax,%rbp
   0x0000555555554c16 &lt;+166&gt;:	cmp    %rbx,%rdi
   0x0000555555554c19 &lt;+169&gt;:	je     0x555555554c20 &lt;main+176&gt;
   0x0000555555554c1b &lt;+171&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554c20 &lt;+176&gt;:	mov    %rbp,%rdi
   0x0000555555554c23 &lt;+179&gt;:	callq  0x555555554b40 &lt;_Unwind_Resume@plt&gt;
End of assembler dump.
(gdb)
</code></pre><p>我们来看一个完整的保存了结构体的复杂版本的，</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Persion</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="n">setAge</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">age_</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="nf">getAge</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="nf">setName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="nf">showPersion</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;age = %d, height = %d&#34;</span><span class="p">,</span> <span class="n">age_</span><span class="p">,</span> <span class="n">height_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span><span class="s">&#34; persion name is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">age_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">height_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="n">Persion</span> <span class="n">persion1</span><span class="p">,</span> <span class="n">Persion</span> <span class="n">persion2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;persion 1 age = %d, persion 2 height = %d&#34;</span><span class="p">,</span><span class="n">persion1</span><span class="p">.</span><span class="n">getAge</span><span class="p">(),</span> <span class="n">persion2</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Persion</span> <span class="nf">getPersoin</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">persion_age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">setAge</span><span class="p">(</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">commonName</span><span class="o">=</span><span class="s">&#34;hello,world&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="n">commonName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">persion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">persion_age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion1</span><span class="p">.</span><span class="n">setAge</span><span class="p">(</span><span class="n">persion_age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Persion</span> <span class="n">persion2</span> <span class="o">=</span> <span class="n">getPersoin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">show</span><span class="p">(</span><span class="n">persion1</span><span class="p">,</span> <span class="n">persion2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion1</span><span class="p">.</span><span class="n">showPersion</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">persion2</span><span class="p">.</span><span class="n">showPersion</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-assembly" data-lang="assembly">Dump of assembler code for function main:
=&gt; 0x0000555555554b70 &lt;+0&gt;:	push   %r14
   0x0000555555554b72 &lt;+2&gt;:	push   %r13
   0x0000555555554b74 &lt;+4&gt;:	lea    0x6b0(%rip),%rdi        # 0x55555555522b
   0x0000555555554b7b &lt;+11&gt;:	push   %r12
   0x0000555555554b7d &lt;+13&gt;:	push   %rbp
   0x0000555555554b7e &lt;+14&gt;:	push   %rbx
   0x0000555555554b7f &lt;+15&gt;:	sub    $0xd0,%rsp
   0x0000555555554b86 &lt;+22&gt;:	lea    0x10(%rsp),%rbx
   0x0000555555554b8b &lt;+27&gt;:	lea    0xc(%rsp),%rsi
   0x0000555555554b90 &lt;+32&gt;:	movq   $0x0,0x20(%rsp)
   0x0000555555554b99 &lt;+41&gt;:	mov    %fs:0x28,%rax
   0x0000555555554ba2 &lt;+50&gt;:	mov    %rax,0xc8(%rsp)
   0x0000555555554baa &lt;+58&gt;:	xor    %eax,%eax
   0x0000555555554bac &lt;+60&gt;:	lea    0x18(%rbx),%rax
   0x0000555555554bb0 &lt;+64&gt;:	movb   $0x0,0x28(%rsp)
   0x0000555555554bb5 &lt;+69&gt;:	movl   $0x0,0xc(%rsp)
   0x0000555555554bbd &lt;+77&gt;:	mov    %rax,0x18(%rsp)
   0x0000555555554bc2 &lt;+82&gt;:	xor    %eax,%eax
   0x0000555555554bc4 &lt;+84&gt;:	callq  0x555555554b20 &lt;scanf@plt&gt;
   0x0000555555554bc9 &lt;+89&gt;:	mov    0xc(%rsp),%eax
   0x0000555555554bcd &lt;+93&gt;:	lea    0x40(%rsp),%rbp
   0x0000555555554bd2 &lt;+98&gt;:	mov    %rbp,%rdi
   0x0000555555554bd5 &lt;+101&gt;:	mov    %eax,0x10(%rsp)
   0x0000555555554bd9 &lt;+105&gt;:	callq  0x555555554fa0 &lt;_Z10getPersoinv&gt;
   0x0000555555554bde &lt;+110&gt;:	mov    0x40(%rsp),%eax
   0x0000555555554be2 &lt;+114&gt;:	lea    0xa0(%rsp),%r12
   0x0000555555554bea &lt;+122&gt;:	mov    0x48(%rsp),%rsi
   0x0000555555554bef &lt;+127&gt;:	mov    0x50(%rsp),%rdx
   0x0000555555554bf4 &lt;+132&gt;:	lea    0x8(%r12),%rdi
   0x0000555555554bf9 &lt;+137&gt;:	mov    %eax,0xa0(%rsp)
   0x0000555555554c00 &lt;+144&gt;:	mov    0x44(%rsp),%eax
   0x0000555555554c04 &lt;+148&gt;:	add    %rsi,%rdx
   0x0000555555554c07 &lt;+151&gt;:	mov    %eax,0xa4(%rsp)
   0x0000555555554c0e &lt;+158&gt;:	lea    0x18(%r12),%rax
   0x0000555555554c13 &lt;+163&gt;:	mov    %rax,0xa8(%rsp)
   0x0000555555554c1b &lt;+171&gt;:	callq  0x555555554eb0 &lt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE12_M_constructIPcEEvT_S7_St20forward_iterator_tag.isra.27&gt;
   0x0000555555554c20 &lt;+176&gt;:	mov    0x10(%rsp),%eax
   0x0000555555554c24 &lt;+180&gt;:	lea    0x70(%rsp),%r13
   0x0000555555554c29 &lt;+185&gt;:	mov    0x18(%rsp),%rsi
   0x0000555555554c2e &lt;+190&gt;:	mov    0x20(%rsp),%rdx
   0x0000555555554c33 &lt;+195&gt;:	lea    0x8(%r13),%rdi
   0x0000555555554c37 &lt;+199&gt;:	mov    %eax,0x70(%rsp)
   0x0000555555554c3b &lt;+203&gt;:	mov    0x14(%rsp),%eax
   0x0000555555554c3f &lt;+207&gt;:	add    %rsi,%rdx
   0x0000555555554c42 &lt;+210&gt;:	mov    %eax,0x74(%rsp)
   0x0000555555554c46 &lt;+214&gt;:	lea    0x18(%r13),%rax
   0x0000555555554c4a &lt;+218&gt;:	mov    %rax,0x78(%rsp)
   0x0000555555554c4f &lt;+223&gt;:	callq  0x555555554eb0 &lt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE12_M_constructIPcEEvT_S7_St20forward_iterator_tag.isra.27&gt;
   0x0000555555554c54 &lt;+228&gt;:	mov    0xa0(%rsp),%ecx
   0x0000555555554c5b &lt;+235&gt;:	mov    0x70(%rsp),%edx
   0x0000555555554c5f &lt;+239&gt;:	lea    0x582(%rip),%rsi        # 0x5555555551e8
   0x0000555555554c66 &lt;+246&gt;:	mov    $0x1,%edi
   0x0000555555554c6b &lt;+251&gt;:	xor    %eax,%eax
   0x0000555555554c6d &lt;+253&gt;:	callq  0x555555554aa0 &lt;__printf_chk@plt&gt;
   0x0000555555554c72 &lt;+258&gt;:	mov    0x78(%rsp),%rdi
   0x0000555555554c77 &lt;+263&gt;:	add    $0x18,%r13
   0x0000555555554c7b &lt;+267&gt;:	cmp    %r13,%rdi
   0x0000555555554c7e &lt;+270&gt;:	je     0x555555554c85 &lt;main+277&gt;
   0x0000555555554c80 &lt;+272&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554c85 &lt;+277&gt;:	mov    0xa8(%rsp),%rdi
   0x0000555555554c8d &lt;+285&gt;:	add    $0x18,%r12
   0x0000555555554c91 &lt;+289&gt;:	cmp    %r12,%rdi
   0x0000555555554c94 &lt;+292&gt;:	je     0x555555554c9b &lt;main+299&gt;
   0x0000555555554c96 &lt;+294&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554c9b &lt;+299&gt;:	mov    %rbx,%rdi
   0x0000555555554c9e &lt;+302&gt;:	callq  0x5555555550e0 &lt;_ZN7Persion11showPersionEv&gt;
   0x0000555555554ca3 &lt;+307&gt;:	mov    %rbp,%rdi
   0x0000555555554ca6 &lt;+310&gt;:	callq  0x5555555550e0 &lt;_ZN7Persion11showPersionEv&gt;
   0x0000555555554cab &lt;+315&gt;:	mov    0x48(%rsp),%rdi
   0x0000555555554cb0 &lt;+320&gt;:	add    $0x18,%rbp
   0x0000555555554cb4 &lt;+324&gt;:	cmp    %rbp,%rdi
   0x0000555555554cb7 &lt;+327&gt;:	je     0x555555554cbe &lt;main+334&gt;
   0x0000555555554cb9 &lt;+329&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554cbe &lt;+334&gt;:	mov    0x18(%rsp),%rdi
   0x0000555555554cc3 &lt;+339&gt;:	add    $0x18,%rbx
   0x0000555555554cc7 &lt;+343&gt;:	cmp    %rbx,%rdi
   0x0000555555554cca &lt;+346&gt;:	je     0x555555554cd1 &lt;main+353&gt;
   0x0000555555554ccc &lt;+348&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554cd1 &lt;+353&gt;:	xor    %eax,%eax
   0x0000555555554cd3 &lt;+355&gt;:	mov    0xc8(%rsp),%rcx
   0x0000555555554cdb &lt;+363&gt;:	xor    %fs:0x28,%rcx
   0x0000555555554ce4 &lt;+372&gt;:	jne    0x555555554cf6 &lt;main+390&gt;
   0x0000555555554ce6 &lt;+374&gt;:	add    $0xd0,%rsp
   0x0000555555554ced &lt;+381&gt;:	pop    %rbx
   0x0000555555554cee &lt;+382&gt;:	pop    %rbp
   0x0000555555554cef &lt;+383&gt;:	pop    %r12
   0x0000555555554cf1 &lt;+385&gt;:	pop    %r13
   0x0000555555554cf3 &lt;+387&gt;:	pop    %r14
   0x0000555555554cf5 &lt;+389&gt;:	retq
   0x0000555555554cf6 &lt;+390&gt;:	callq  0x555555554b00 &lt;__stack_chk_fail@plt&gt;
   0x0000555555554cfb &lt;+395&gt;:	mov    0x78(%rsp),%rdi
   0x0000555555554d00 &lt;+400&gt;:	add    $0x18,%r13
   0x0000555555554d04 &lt;+404&gt;:	mov    %rax,%r14
   0x0000555555554d07 &lt;+407&gt;:	cmp    %r13,%rdi
   0x0000555555554d0a &lt;+410&gt;:	je     0x555555554d11 &lt;main+417&gt;
   0x0000555555554d0c &lt;+412&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554d11 &lt;+417&gt;:	mov    %r14,%r13
   0x0000555555554d14 &lt;+420&gt;:	mov    0xa8(%rsp),%rdi
   0x0000555555554d1c &lt;+428&gt;:	add    $0x18,%r12
   0x0000555555554d20 &lt;+432&gt;:	cmp    %r12,%rdi
   0x0000555555554d23 &lt;+435&gt;:	je     0x555555554d2a &lt;main+442&gt;
   0x0000555555554d25 &lt;+437&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554d2a &lt;+442&gt;:	mov    %r13,%r12
   0x0000555555554d2d &lt;+445&gt;:	mov    0x48(%rsp),%rdi
   0x0000555555554d32 &lt;+450&gt;:	add    $0x18,%rbp
   0x0000555555554d36 &lt;+454&gt;:	cmp    %rbp,%rdi
   0x0000555555554d39 &lt;+457&gt;:	je     0x555555554d40 &lt;main+464&gt;
   0x0000555555554d3b &lt;+459&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554d40 &lt;+464&gt;:	mov    0x18(%rsp),%rdi
   0x0000555555554d45 &lt;+469&gt;:	add    $0x18,%rbx
   0x0000555555554d49 &lt;+473&gt;:	cmp    %rbx,%rdi
   0x0000555555554d4c &lt;+476&gt;:	je     0x555555554d53 &lt;main+483&gt;
   0x0000555555554d4e &lt;+478&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555554d53 &lt;+483&gt;:	mov    %r12,%rdi
   0x0000555555554d56 &lt;+486&gt;:	callq  0x555555554b40 &lt;_Unwind_Resume@plt&gt;
   0x0000555555554d5b &lt;+491&gt;:	mov    %rax,%r13
   0x0000555555554d5e &lt;+494&gt;:	jmp    0x555555554d14 &lt;main+420&gt;
   0x0000555555554d60 &lt;+496&gt;:	mov    %rax,%r12
   0x0000555555554d63 &lt;+499&gt;:	jmp    0x555555554d2d &lt;main+445&gt;
   0x0000555555554d65 &lt;+501&gt;:	mov    %rax,%r12
   0x0000555555554d68 &lt;+504&gt;:	jmp    0x555555554d40 &lt;main+464&gt;
End of assembler dump.
(gdb)
Dump of assembler code for function _Z10getPersoinv:
=&gt; 0x0000555555554fa0 &lt;+0&gt;:	push   %r14
   0x0000555555554fa2 &lt;+2&gt;:	push   %r13
   0x0000555555554fa4 &lt;+4&gt;:	lea    0x18(%rdi),%r13
   0x0000555555554fa8 &lt;+8&gt;:	push   %r12
   0x0000555555554faa &lt;+10&gt;:	push   %rbp
   0x0000555555554fab &lt;+11&gt;:	push   %rbx
   0x0000555555554fac &lt;+12&gt;:	mov    %rdi,%rbx
   0x0000555555554faf &lt;+15&gt;:	sub    $0x60,%rsp
   0x0000555555554fb3 &lt;+19&gt;:	mov    %r13,0x8(%rdi)
   0x0000555555554fb7 &lt;+23&gt;:	movq   $0x0,0x10(%rdi)
   0x0000555555554fbf &lt;+31&gt;:	movb   $0x0,0x18(%rdi)
   0x0000555555554fc3 &lt;+35&gt;:	lea    0xc(%rsp),%rsi
   0x0000555555554fc8 &lt;+40&gt;:	lea    0x25c(%rip),%rdi        # 0x55555555522b
   0x0000555555554fcf &lt;+47&gt;:	mov    %fs:0x28,%rax
   0x0000555555554fd8 &lt;+56&gt;:	mov    %rax,0x58(%rsp)
   0x0000555555554fdd &lt;+61&gt;:	xor    %eax,%eax
   0x0000555555554fdf &lt;+63&gt;:	movl   $0x0,0xc(%rsp)
   0x0000555555554fe7 &lt;+71&gt;:	callq  0x555555554b20 &lt;scanf@plt&gt;
   0x0000555555554fec &lt;+76&gt;:	mov    0xc(%rsp),%eax
   0x0000555555554ff0 &lt;+80&gt;:	lea    0x10(%rsp),%r12
   0x0000555555554ff5 &lt;+85&gt;:	lea    0x24f(%rip),%rdx        # 0x55555555524b
   0x0000555555554ffc &lt;+92&gt;:	lea    -0xb(%rdx),%rsi
   0x0000555555555000 &lt;+96&gt;:	mov    %r12,%rdi
   0x0000555555555003 &lt;+99&gt;:	mov    %eax,(%rbx)
   0x0000555555555005 &lt;+101&gt;:	lea    0x10(%r12),%rax
   0x000055555555500a &lt;+106&gt;:	mov    %rax,0x10(%rsp)
   0x000055555555500f &lt;+111&gt;:	callq  0x555555554eb0 &lt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE12_M_constructIPcEEvT_S7_St20forward_iterator_tag.isra.27&gt;
   0x0000555555555014 &lt;+116&gt;:	lea    0x30(%rsp),%rbp
   0x0000555555555019 &lt;+121&gt;:	mov    0x10(%rsp),%rsi
   0x000055555555501e &lt;+126&gt;:	mov    0x18(%rsp),%rdx
   0x0000555555555023 &lt;+131&gt;:	lea    0x10(%rbp),%rax
   0x0000555555555027 &lt;+135&gt;:	mov    %rbp,%rdi
   0x000055555555502a &lt;+138&gt;:	add    %rsi,%rdx
   0x000055555555502d &lt;+141&gt;:	mov    %rax,0x30(%rsp)
   0x0000555555555032 &lt;+146&gt;:	callq  0x555555554eb0 &lt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE12_M_constructIPcEEvT_S7_St20forward_iterator_tag.isra.27&gt;
   0x0000555555555037 &lt;+151&gt;:	lea    0x8(%rbx),%rdi
   0x000055555555503b &lt;+155&gt;:	mov    %rbp,%rsi
   0x000055555555503e &lt;+158&gt;:	callq  0x555555554ab0 &lt;_ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE9_M_assignERKS4_@plt&gt;
   0x0000555555555043 &lt;+163&gt;:	mov    0x30(%rsp),%rdi
   0x0000555555555048 &lt;+168&gt;:	add    $0x10,%rbp
   0x000055555555504c &lt;+172&gt;:	cmp    %rbp,%rdi
   0x000055555555504f &lt;+175&gt;:	je     0x555555555056 &lt;_Z10getPersoinv+182&gt;
   0x0000555555555051 &lt;+177&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555555056 &lt;+182&gt;:	mov    0x10(%rsp),%rdi
   0x000055555555505b &lt;+187&gt;:	add    $0x10,%r12
   0x000055555555505f &lt;+191&gt;:	cmp    %r12,%rdi
   0x0000555555555062 &lt;+194&gt;:	je     0x555555555069 &lt;_Z10getPersoinv+201&gt;
   0x0000555555555064 &lt;+196&gt;:	callq  0x555555554af0 &lt;_ZdlPv@plt&gt;
   0x0000555555555069 &lt;+201&gt;:	mov    0x58(%rsp),%rcx
   0x000055555555506e &lt;+206&gt;:	xor    %fs:0x28,%rcx
   0x0000555555555077 &lt;+215&gt;:	mov    %rbx,%rax
   0x000055555555507a &lt;+218&gt;:	jne    0x555555555089 &lt;_Z10getPersoinv+233&gt;
   0x000055555555507c &lt;+220&gt;:	add    $0x60,%rsp
   0x0000555555555080 &lt;+224&gt;:	pop    %rbx
   0x0000555555555081 &lt;+225&gt;:	pop    %rbp
   0x0000555555555082 &lt;+226&gt;:	pop    %r12
   0x0000555555555084 &lt;+228&gt;:	pop    %r13
   0x0000555555555086 &lt;+230&gt;:	pop    %r14
   0x0000555555555088 &lt;+232&gt;:	retq
</code></pre>

<h3 class="relative group">13.6 构造函数和析构函数 
    <div id="136-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#136-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h3 class="relative group">13.7 虚函数 
    <div id="137-%E8%99%9A%E5%87%BD%E6%95%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#137-%E8%99%9A%E5%87%BD%E6%95%B0" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h3 class="relative group">13.8 类的关系 
    <div id="138-%E7%B1%BB%E7%9A%84%E5%85%B3%E7%B3%BB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#138-%E7%B1%BB%E7%9A%84%E5%85%B3%E7%B3%BB" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h2 class="relative group">一些代码范例 
    <div id="%E4%B8%80%E4%BA%9B%E4%BB%A3%E7%A0%81%E8%8C%83%E4%BE%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%80%E4%BA%9B%E4%BB%A3%E7%A0%81%E8%8C%83%E4%BE%8B" aria-label="锚点">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> b main
</span></span><span class="line"><span class="cl">Breakpoint <span class="m">1</span> at 0x55555555464e
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> r
</span></span><span class="line"><span class="cl">Starting program: /home/qcraft/code_test/ass_c++/a.out
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Breakpoint 1, 0x000055555555464e in main <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> disass
</span></span><span class="line"><span class="cl">Dump of assembler code <span class="k">for</span> <span class="k">function</span> main:
</span></span><span class="line"><span class="cl">   0x000055555555464a &lt;+0&gt;:	push   %rbp
</span></span><span class="line"><span class="cl">   0x000055555555464b &lt;+1&gt;:	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x000055555555464e &lt;+4&gt;:	sub    <span class="nv">$0</span>x20,%rsp
</span></span><span class="line"><span class="cl">   0x0000555555554652 &lt;+8&gt;:	mov    %edi,-0x14<span class="o">(</span>%rbp<span class="o">)</span>
</span></span><span class="line"><span class="cl">   0x0000555555554655 &lt;+11&gt;:	mov    %rsi,-0x20<span class="o">(</span>%rbp<span class="o">)</span>
</span></span><span class="line"><span class="cl">   0x0000555555554659 &lt;+15&gt;:	cvtsi2ssl -0x14<span class="o">(</span>%rbp<span class="o">)</span>,%xmm0
</span></span><span class="line"><span class="cl">   0x000055555555465e &lt;+20&gt;:	movss  %xmm0,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
</span></span><span class="line"><span class="cl">   0x0000555555554663 &lt;+25&gt;:	cvtss2sd -0x4<span class="o">(</span>%rbp<span class="o">)</span>,%xmm0
</span></span><span class="line"><span class="cl">   0x0000555555554668 &lt;+30&gt;:	lea    0xc5<span class="o">(</span>%rip<span class="o">)</span>,%rdi        <span class="c1"># 0x555555554734</span>
</span></span><span class="line"><span class="cl">   0x000055555555466f &lt;+37&gt;:	mov    <span class="nv">$0</span>x1,%eax
</span></span><span class="line"><span class="cl">   0x0000555555554674 &lt;+42&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
</span></span><span class="line"><span class="cl">   0x0000555555554679 &lt;+47&gt;:	movss  -0x4<span class="o">(</span>%rbp<span class="o">)</span>,%xmm0
</span></span><span class="line"><span class="cl">   0x000055555555467e &lt;+52&gt;:	cvttss2si %xmm0,%eax
</span></span><span class="line"><span class="cl">   0x0000555555554682 &lt;+56&gt;:	mov    %eax,-0x14<span class="o">(</span>%rbp<span class="o">)</span>
</span></span><span class="line"><span class="cl">   0x0000555555554685 &lt;+59&gt;:	mov    -0x14<span class="o">(</span>%rbp<span class="o">)</span>,%eax
</span></span><span class="line"><span class="cl">   0x0000555555554688 &lt;+62&gt;:	mov    %eax,%esi
</span></span><span class="line"><span class="cl">   0x000055555555468a &lt;+64&gt;:	lea    0xa6<span class="o">(</span>%rip<span class="o">)</span>,%rdi        <span class="c1"># 0x555555554737</span>
</span></span><span class="line"><span class="cl">   0x0000555555554691 &lt;+71&gt;:	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">   0x0000555555554696 &lt;+76&gt;:	callq  0x555555554520 &lt;printf@plt&gt;
</span></span><span class="line"><span class="cl">   0x000055555555469b &lt;+81&gt;:	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">   0x00005555555546a0 &lt;+86&gt;:	leaveq
</span></span><span class="line"><span class="cl">   0x00005555555546a1 &lt;+87&gt;:	retq
</span></span><span class="line"><span class="cl">End of assembler dump.
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> shell cat test.cpp
</span></span><span class="line"><span class="cl"><span class="c1">#include &lt;stdio.h&gt;</span>
</span></span><span class="line"><span class="cl">int main<span class="o">(</span>int argc, char* argv<span class="o">[])</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  float <span class="nv">f</span> <span class="o">=</span> <span class="o">(</span>float<span class="o">)</span>argc<span class="p">;</span>
</span></span><span class="line"><span class="cl">  printf<span class="o">(</span><span class="s2">&#34;%f&#34;</span>, f<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">argc</span> <span class="o">=</span> <span class="o">(</span>int<span class="o">)</span>f<span class="p">;</span>
</span></span><span class="line"><span class="cl">  printf<span class="o">(</span><span class="s2">&#34;%d&#34;</span>, argc<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> 0<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span></code></pre></div>

<h2 class="relative group">14 linux 二进制分析学习 
    <div id="14-linux-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#14-linux-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">15  linux kernel mod and code protect 
    <div id="15--linux-kernel-mod-and-code-protect" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#15--linux-kernel-mod-and-code-protect" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h3 class="relative group">15.1 lkm 
    <div id="151-lkm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#151-lkm" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Refer to <a href="https://xcellerator.github.io/posts/linux_rootkits_01/" target="_blank">https://xcellerator.github.io/posts/linux_rootkits_01/</a></p>


<h2 class="relative group">结尾 
    <div id="%E7%BB%93%E5%B0%BE" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%BB%93%E5%B0%BE" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>唉，尴尬</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.loli.net/2020/08/27/BFHNyfpx3EsIDUG.jpg" alt="狗头的赞赏码.jpg" />
    
  </figure>
<a href=""></a></p>

          
          
          
        </div>
        
        

        
        

          
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/2021-01-31-汇编笔记\/index.md"
        var oid_likes = "likes_posts\/2021-01-31-汇编笔记\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/posts/2021-01-28-%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >代码整洁之道</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2021-01-28T00:00:00&#43;00:00">2021 年 1 月 28 日</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/posts/2023-02-12-%E5%AE%89%E5%85%A8%E9%9B%B6%E4%BF%A1%E4%BB%BB/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >2023-02-12-安全零信任</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2021-02-22T00:00:00&#43;00:00">2021 年 2 月 22 日</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="返回顶部" title="返回顶部">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      © 2025 - 2025 菜狗 All Rights Reserved.
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> 强力驱动
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://hxndg.github.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="搜索"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="关闭 (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
