<!doctype html><html lang=cn dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh-cn"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>异步程序编写时候的一些小教训 &#183; 菜狗的blog</title>
<meta name=title content="异步程序编写时候的一些小教训 &#183; 菜狗的blog"><meta name=description content="菜狗's website"><meta name=keywords content="架构,"><link rel=canonical href=https://hxndg.github.io/posts/2020-12-15-%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD/><link type=text/css rel=stylesheet href=/css/main.bundle.min.ba3775bebd52a2b4837f8da64e32ee36e5c52bf284a0ce2262562782398b701543947527ad1498487717b1b96fe2a4e48d365a02e0b5d00e224893052e99d83c.css integrity><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.764eb2fe8d6a6b086c7c58f87d12c64fa79a7585117fc27eb53f688f80c287a6eff16277f9d186cd223a39ff700e294d64482834faece5e07ee0498fa042d056.js integrity="sha512-dk6y/o1qawhsfFj4fRLGT6eadYURf8J+tT9oj4DCh6bv8WJ3+dGGzSI6Of9wDilNZEgoNPrs5eB+4EmPoELQVg==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.3530c2657381259433194af312ec3d322a97a2ad85661810299757fe793b24c3b8e07ab97fa8e5cf96cff1208f271e75394b6eaa56c2e39e7e2c3ca49fb1921c.js integrity="sha512-NTDCZXOBJZQzGUrzEuw9MiqXoq2FZhgQKZdX/nk7JMO44Hq5f6jlz5bP8SCPJx51OUtuqlbC455+LDykn7GSHA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://hxndg.github.io/posts/2020-12-15-%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD/"><meta property="og:site_name" content="菜狗的blog"><meta property="og:title" content="异步程序编写时候的一些小教训"><meta property="og:description" content="菜狗's website"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-15T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-15T00:00:00+00:00"><meta property="article:tag" content="架构"><meta property="og:image" content="https://hxndg.github.io/posts/2020-12-15-%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hxndg.github.io/posts/2020-12-15-%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD/featured.png"><meta name=twitter:title content="异步程序编写时候的一些小教训"><meta name=twitter:description content="菜狗's website"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"异步程序编写时候的一些小教训","headline":"异步程序编写时候的一些小教训","inLanguage":"zh-cn","url":"https:\/\/hxndg.github.io\/posts\/2020-12-15-%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD\/","author":{"@type":"Person","name":"菜狗"},"copyrightYear":"2020","dateCreated":"2020-12-15T00:00:00\u002b00:00","datePublished":"2020-12-15T00:00:00\u002b00:00","dateModified":"2020-12-15T00:00:00\u002b00:00","keywords":["架构"],"mainEntityOfPage":"true","wordCount":"6105"}]</script><meta name=author content="菜狗"><script src=/lib/jquery/jquery.slim.min.03cb160e3cfdb2667a2e2c80d283bebcf63ff8bbc4b629c9ab2babf6fae1d0c07ad470edae783efa4fabda2ac01c58d60e63b98b3c336be8208460f08f4354f5.js integrity="sha512-A8sWDjz9smZ6LiyA0oO+vPY/+LvEtinJqyur9vrh0MB61HDtrng++k+r2irAHFjWDmO5izwza+gghGDwj0NU9Q=="></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">菜狗的blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Home</p></a><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Posts</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Tags</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Home</p></a></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Posts</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Tags</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/posts/2020-12-15-%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD/featured_hu15449549434909233685.png)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">异步程序编写时候的一些小教训</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2020-12-15T00:00:00+00:00>2020 年 12 月 15 日</time><span class="px-2 text-primary-500">&#183;</span><span>6105 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>13 分钟</span></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">菜狗</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Focus</div><div class="text-2xl sm:text-lg"></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#针对通俗事件的教训>针对通俗事件的教训</a></li><li><a href=#单独针对异步的教训>单独针对异步的教训</a></li><li><a href=#针对通用程序的教训>针对通用程序的教训</a></li><li><a href=#对代码的熟悉程度>对代码的熟悉程度</a><ul><li><a href=#写程序的时候要注意的>写程序的时候要注意的</a></li></ul></li><li><a href=#针对多线程编程的教训>针对多线程编程的教训</a></li><li><a href=#针对需求合理性>针对需求合理性</a></li><li><a href=#如何编写文档>如何编写文档</a><ul><li><ul><li><a href=#heading></a></li></ul></li></ul></li><li><a href=#一些学习到的常见的小技巧>一些学习到的常见的小技巧</a><ul><li><a href=#位运算>位运算</a></li><li><a href=#优先级>优先级</a></li></ul></li><li><a href=#结尾>结尾</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#针对通俗事件的教训>针对通俗事件的教训</a></li><li><a href=#单独针对异步的教训>单独针对异步的教训</a></li><li><a href=#针对通用程序的教训>针对通用程序的教训</a></li><li><a href=#对代码的熟悉程度>对代码的熟悉程度</a><ul><li><a href=#写程序的时候要注意的>写程序的时候要注意的</a></li></ul></li><li><a href=#针对多线程编程的教训>针对多线程编程的教训</a></li><li><a href=#针对需求合理性>针对需求合理性</a></li><li><a href=#如何编写文档>如何编写文档</a><ul><li><ul><li><a href=#heading></a></li></ul></li></ul></li><li><a href=#一些学习到的常见的小技巧>一些学习到的常见的小技巧</a><ul><li><a href=#位运算>位运算</a></li><li><a href=#优先级>优先级</a></li></ul></li><li><a href=#结尾>结尾</a></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">异步程序编写时候的一些小教训<div id=%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E5%80%99%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%BC%82%E6%AD%A5%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%97%B6%E5%80%99%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%95%99%E8%AE%AD aria-label=锚点>#</a></span></h1><h2 class="relative group">前言<div id=%E5%89%8D%E8%A8%80 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%89%8D%E8%A8%80 aria-label=锚点>#</a></span></h2><p>写博客是为了什么？放松脑子，构建自己的模型</p><h2 class="relative group">针对通俗事件的教训<div id=%E9%92%88%E5%AF%B9%E9%80%9A%E4%BF%97%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%95%99%E8%AE%AD class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%92%88%E5%AF%B9%E9%80%9A%E4%BF%97%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%95%99%E8%AE%AD aria-label=锚点>#</a></span></h2><ul><li>开会的时候，应当提前就确定好：1要讨论的点，2 自己的观点，3基本观点必须遵守的原则。将无用的思考/争论时间去掉。如果必然发生讨论，那么要注意基本原则的有效和一致性。</li><li>代码的研发/BUG的报告要遵循一惯性的观点，不应当想到啥是啥。</li><li>绕开难度大的东西，去做简单的事情是一种非常取巧的事情。这种追求简单的东西看上去似乎效率高，但实际上是一种懦弱的行为。正如同"你面前有两条路，选择荆棘丛生的那条"</li><li>做事应该包含三个层面，本身层面：熟悉这东西的方方面面，横向对比和理念对比，纵向的观点</li><li>判断事情是不是要做应当包含一个对边际效应的考虑，是不是值得做，有没有效益做需要考虑，但是这个效益要怎么考虑呢？</li><li>思考问题的方法是自顶向下还是自底向上的呢?要避免手里是个锤子，看啥都是钉子</li></ul><h2 class="relative group">单独针对异步的教训<div id=%E5%8D%95%E7%8B%AC%E9%92%88%E5%AF%B9%E5%BC%82%E6%AD%A5%E7%9A%84%E6%95%99%E8%AE%AD class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%8D%95%E7%8B%AC%E9%92%88%E5%AF%B9%E5%BC%82%E6%AD%A5%E7%9A%84%E6%95%99%E8%AE%AD aria-label=锚点>#</a></span></h2><ul><li>任何内存申请，或者说明显的状态转换，乃至大的标记的转移，都需要在外部明显的标识出来，不要藏在犄角旮旯里。</li><li>对于任何说出来的结论，都要进行论证，“不理智的人扭曲事实来适应理论，而不是改变理论来适应事实”，不要过早的得出结论，要找到足够的证据证明你的猜测。</li><li>凡是参与到运算，或者说要多次采用的东西，都要保证其值不能在中间的时候发生改变，如果可能有其他线程修改，那就需要自己保存下来。</li><li>如果类似内存申请的操作，需要好几个参与，其中一个失败了，剩下的几个务必也要释放。不要留着，否则重入可能造成内存leak</li></ul><h2 class="relative group">针对通用程序的教训<div id=%E9%92%88%E5%AF%B9%E9%80%9A%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%95%99%E8%AE%AD class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%92%88%E5%AF%B9%E9%80%9A%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%95%99%E8%AE%AD aria-label=锚点>#</a></span></h2><ul><li>程序在进行设计开发的时候应该进行良好的抽象与设计：模块化，层次化最好在一开始就保持。在进行后续代码的开发时，同样要求层次和模块的开发。层次的划分和模块的划分是重点与难点，建议看看《代码大全》</li><li>对程序的测试应当经过充分的考虑，很多时候参数的有效性是否开放是要经过考虑的。</li></ul><p>下面三条都是看《多处理器编程的艺术》时候的教训，代码逻辑&现实逻辑，具体的原有看第七章TAS & TTAS设计实现的感想：</p><ul><li>代码层面我们认为逻辑一致性的东西，已经在一定程度上避免了问题的出现，但是这种层面只是问题设计的第一层面</li><li>因为代码是需要跑的，所以在实现的时候不但要考虑上层层面，还要考虑底层层面的实现，对锁而言就是缓存协议，同步等的代价</li><li>最后一个就是要养成一个从上向下，看到底层的习惯了。还得尝试提出，实现方面的抽象。</li></ul><p>代码整洁相关的教训直接看《代码整洁之道》里面总结的代码规范，</p><h2 class="relative group">对代码的熟悉程度<div id=%E5%AF%B9%E4%BB%A3%E7%A0%81%E7%9A%84%E7%86%9F%E6%82%89%E7%A8%8B%E5%BA%A6 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%AF%B9%E4%BB%A3%E7%A0%81%E7%9A%84%E7%86%9F%E6%82%89%E7%A8%8B%E5%BA%A6 aria-label=锚点>#</a></span></h2><p>什么叫做对代码的很熟悉？从我个人的角度来看，一般是以下几个方面：</p><ul><li>自动机中功能性的划分，能迅速找到功能划分的位置。</li><li>针对某些异常情况的处理，能迅速找到在不同步骤出异常或问题时的处理流程。</li><li>系统竞争和瓶颈所在地，能迅速找到可能导致并发 /新建问题出现的地方。</li><li>多线程或多进程同步的地方，能迅速分析清楚具体是哪种同步模型。</li><li>能够将模块中可拆分 /变化的部分迅速找到，并零件化</li><li>附加一个学习thrift的时候的经验，应当熟悉并排查常见的运用该工具所遇见的错误和导致的问题，简单来说就是编程的时候需要遵守某种规范，那么如果不遵守这种规范，会出现什么错误和问题。</li></ul><p>类比代码，可以得出对CI/CD环境的教训</p><h3 class="relative group">写程序的时候要注意的<div id=%E5%86%99%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%97%B6%E5%80%99%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%86%99%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%97%B6%E5%80%99%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84 aria-label=锚点>#</a></span></h3><ul><li><p>写一个函数，要注意把每个覆盖的路径都正确，不能只保证一部分路径</p></li><li><p>要注意层次，每层尽量只干一件事情，同时减少只出现一次的东西被单独拿出来初始化，比方说</p><pre tabindex=0><code>const std::string test_sets = request-&gt;test_sets();
</code></pre></li><li><p>if else不要出现太多条件，如果条件超过三个，建议成为函数</p></li><li><p>分层，拆成一层一层的观点，逐步的减少复杂度</p></li><li><p>接口，接口尽量明确，不要出现一个string打掉所有的情况，尽量明确到具体的比方说MAP&lt;Key/value></p></li><li><p>对于一些新加的函数/接口/实现，不要追求和过去完全一致，可以改变数据结构的选择，使用map等，最直接的例子就是</p><pre tabindex=0><code>message ListScenariosRequest {
  optional string filter = 1;
  optional string page_token = 2;
  optional int32 page_size = 3;
  optional bool trace_history = 4;
  optional bool include_original_scenarios = 5;
  // test set filter
  optional string test_sets = 6;
  // experimental scenario test filter
  optional bool include_experimental = 7;
  // scenario name regex filter
  optional string scenario_re = 8;
  // china mode filter
  optional bool china_mode = 9;
  // match labels filter
  optional string match_labels = 10;    //这个地方就应该转换为map&lt;string, string&gt;来做，而不应该继续使用现在的string
}
</code></pre></li><li><p>接口设计的时候要考虑数据类型的匹配，比方说map里面有key:country，value为 China/US，如果使用bool值那么只能表示中国或美国一种，但是有一种情况是map里面没有country这个key。换言之直接条件崩了，所以这个时候选择bool表示国家并不好，它表示的是中国或者不是中国，这种设计很糟糕</p></li></ul><h2 class="relative group">针对多线程编程的教训<div id=%E9%92%88%E5%AF%B9%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E7%9A%84%E6%95%99%E8%AE%AD class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%92%88%E5%AF%B9%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E7%9A%84%E6%95%99%E8%AE%AD aria-label=锚点>#</a></span></h2><p>看这个链接https://www.quora.com/How-does-STL-vector-map-etc-work-in-multithreading-environments-in-C++和这个链接https://en.cppreference.com/w/cpp/container#Thread_safety。敲黑板，记住：</p><ul><li>读写安全但是添加删除是不安全的。实际上某个数据结构是不是线程安全的就在于可不可以将数据结构的修改/删除/插入linerable</li><li>任何使得iterator无效的操作都必须同步化，但是push_back这种倒是对前面的操作无所谓。</li></ul><h2 class="relative group">针对需求合理性<div id=%E9%92%88%E5%AF%B9%E9%9C%80%E6%B1%82%E5%90%88%E7%90%86%E6%80%A7 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E9%92%88%E5%AF%B9%E9%9C%80%E6%B1%82%E5%90%88%E7%90%86%E6%80%A7 aria-label=锚点>#</a></span></h2><p>写这个是因为需求合理性经常被CHALLENGE，所以给出一个综合性的需求文档的设计。</p><ul><li>首先需要明确<strong>客户是谁，客户的场景是什么样子的</strong>，明确客户是谁非常重要，</li><li>这个需求究竟是<strong>客户提出来的，还是只是顺嘴提一句，SE随手加上的</strong>？很多时候SE根本就不懂这个功能，就是胡说八道，因此需要确认是不是真正的需求。（去了qcraft又一次遇到了这个问题，目前遇到的事情是要写一个qsim cache，但是qsim cache具体需要什么功能不确定）</li><li>需要明确一点，需求往往是高层的，而具体的解决方案是开发做的，要区分开这两个层面</li><li>这个需求是不是SPECIAL的呢？换言之是一个通用性FEATURE还是单独的FEATURE（就这个客户用？），<strong>通用性</strong>再考虑做。</li><li><strong>这个需求是抄谁的？或者参考谁的</strong>？原本的场景和现在的场景哪些相同，哪些不同。是不是可以原样复制原本的解决方案？</li><li>和我们目前的功能有没有一致性？有没有连续性方面的东西考虑？</li></ul><p>从实现角度考虑</p><ul><li>细化需求的实现难度，按照实现难度和效益进行排序。过于难/不合理的实现直接拒绝。</li><li>对于领导而言，更喜欢更简单，更直接的解决方式</li></ul><p>从真实实现角度，在确定需求之前</p><ul><li>如果太难解决，就将客户的需求条列化以后和leader讨论一下</li><li>和不同的人聊天，看看这个功能有没有类似的，究竟做不做，如果做，从哪个方面做起？为什么不做？</li></ul><p>和QA讨论</p><ul><li>一个功能，对客户而言应该足够简单，简单才能有人用。</li></ul><p>相对应的，这个网址https://www.pmcaff.com/discuss/439444879874112上面的例子很不错，下面截取了一些具体的回复。</p><p><a href="https://www.pmcaff.com/user/profile/8gLpZerbB5?newwindow=1" target=_blank>CarriePisces</a>的回复</p><blockquote><p>我们不能随意抛弃任何一个需求，不管是否合理，这是基本原则。</p><p>拿到这些需求后，做如下步骤：</p><p>1、首先看该需求当前的版本是否满足？如果可以满足，是否比当前更优？不能满足是否有替代功能可以满足？如果满足是否可以更优？</p><p>2、当前版本功能均不能满足的情况下，一定要跟需求提出者进行一次深入沟通（<strong>千万不要一口回绝，即使你觉得非常十分以及特别不合理</strong>），了解他提出这个需求的原因、使用场景、带来的意义等，经过反复沟通，你也许会发现有些人的需求跟第一次告诉你会有差异，这是正常的，所以需要沟通沟通再沟通，究其原因。</p><p>3、沟通后，你大致有了自己的看法。是否要做，你这时可以结合市场分析、自身产品定位、资源配置等进行整理资料，去说服对方，并且讲明为什么现在不做这样需求。当然了，话不能讲得太满，比如“这个需求经过以下情况分析，balabala<del>不合理，所以不做”，可以稍微改动下“这个需求经过以下情况分析，balabala</del>目前看来是不适合做入产品的，但是这是一个好的想法，我们先纳入需求池，根据后期产品发展情况做进一步考虑，只是暂时搁置~”。毕竟，直接否决别人伤和气，再者，有些需求其实只是目前不合理，后期怎样就不一定咯~</p><p>4、如果还是不能说服对方的话，23333333，先反省自己，分析得是否合理，语言表达是否清楚，是否有完善的数据支撑。。。如果还是不行的话，没有什么是请吃一顿火锅解决不了的，如果有，那就请吃两顿。#经费自己掏腰包哈#</p><p>最后，作为一个产品人，真的不用轻易抛弃和鄙视任何一个需求呀，深挖出实际需求，毕竟，肯给你提需求的是关注你产品的人，不关注的人才懒得理你呢~</p><p>嗯，瞎扯完毕。#说的不对的地方指出来哈，一起进步#</p></blockquote><p>知乎的网址也给出了具体的例子，https://www.zhihu.com/question/19804178/answer/274824703</p><blockquote><p><em><strong>Step1.有效性分析</strong></em></p><ul><li>面向哪些用户（用户有效）？</li><li>针对哪些特定的场景（场景有效）？</li><li>解决什么问题（痛点有效）？</li></ul><p><em><strong>Step2.可行性分析</strong></em></p><ul><li><strong>与产品先前的设定不出现大的反差</strong></li><li><strong>核心功能不能受到影响或者回退</strong></li><li><strong>.性价比不能太低</strong>(这个实际上就对应了成本)</li></ul><p><em><strong>Step3.对比分析</strong></em></p><ul><li><strong>对比竞争对手</strong></li><li><strong>对比主流价值观</strong></li><li><strong>对比用户行为</strong></li></ul></blockquote><p>这个网址也给出了一些细节https://zhuanlan.zhihu.com/p/23223059。关于具体决定需求对不对使用了一种投票的手段，很不错。</p><h2 class="relative group">如何编写文档<div id=%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E6%96%87%E6%A1%A3 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E6%96%87%E6%A1%A3 aria-label=锚点>#</a></span></h2><p>无论是廖雪峰还是外网的文档，都是从具体规范和格式角度编写文档，而我总结的文档规范主要从内容角度出发。下面给出文档编写流程中的常见考虑方法</p><ul><li><p>首先需要标准化技术术语，避免出现由于中文互联网的不准确性和语义的复杂性导致的错误意义（举个简单的例子，HASH算法中的压缩函数本来应该只是参与计算的一个流程，而有人把HASH本身成为压缩函数）</p></li><li><p>对文档阅读者建模，主要从以下几个角度来考虑：谁阅读这篇文档，阅读者的教育水平（对专业知识的了解），因此哪些部分要详细？</p></li><li><p>如果文档当中有客户的需求，要说出来客户最开始的原始需求是什么，需求经过了什么变化，为什么会有这种变化，多方需求要写清楚每一方的变化。</p></li><li><p>如果文档中有原有功能的局限性，这个需要写具体局限性体现在哪个方面，该功能处于哪一层，为什么要在本层做，便利和优势有哪些，灵活性为什么这样子考虑。</p></li><li><p>如果文档为设计文档，当中需要有detailed description，务必写清楚我们解决的问题是什么，功能实现的手段，我们做的工作是什么。为了能够方便快速地理解，需要文档编写者遵循一定地框架进行描述：1 分层描述，每层具体提供了什么功能，可以依托现有协议地层次，或者依托功能划分地层次进行描述；2 给出每一层我们依赖地第三方/基础功能，并说明每层对上层提供地保证和利用的下层的依赖。层次之间的够通也需要说清楚。</p></li><li><p>如果文档针对QA，那么需要给出TestConsiderration，如果是针对开发，要写清楚连贯的逻辑和准则，如果是针对用户，需要给出详尽的使用流程。这里使用流程要说明白，包括详尽的命令提示信息，帮助信息，测试CASE覆盖等多个方面。</p></li><li><p>上面的部分覆盖了编写的思路，具体的内容我觉得我司的文档模板就写的很不错，包括以下部分：1.1. Problem Statement：；1.1. High Level Overview of this Feature/Function；2. External Requirement；2.1. Customer Requirement；2.1. Usage Scenario；3. Competitor Analysis；4. Function Specification；4.1. Detailed Description of this Feature/Function；4.21.1. Scalability and Performance Target；4.3 Dependencies and Considerations 4.4 Future Enhancements (Optional)；5. User Interface 6 Backward Compatibility 7 Platform Support (Optional) 8 Packaging Consideration 9 Security Consideration 10 1. Testing Consideration 11. Troubleshooting Consideration 12 . Issue and Limitation Reference主要是参考</p></li></ul><p>下面的各个部分并不单独针对需求/设计文档，是通用的文档内容。下面列出来详尽的每个部分该写些什么内容。</p><ul><li>1.1. Problem Statement: 1. Is there any background information for this problem? 2. What is the problem we are trying to solve? 3. Is there any specific information from customers?</li><li>1.2. High Level Overview of this Feature/Function : [This section should cover the high-level function description.]</li><li>2.1 Customer Requirement:[This section should cover the details of the customer requirements.]</li><li>2.2. Usage Scenario : [This section should cover the usage/configuration steps from the user perspective.]</li><li>3.1 Competitor Analysis:\1. Which competitors to compete with?\2. What is the developing status of the industry and competitors?\3. What have the competitors done to meet the same or similar customer requirement?\4. What are their solution’s advantages and disadvantages?</li><li>4.1. Detailed Description of this Feature/Function: [This section should cover the following contents: issues with system integration, memory, reliability, forward and/or backward compatibility, etc.]</li><li>4.2. Scalability and Performance Target \1. Does this feature have any scalability or performance target?\2. What are the settings of external parameters and limits for this requirement?</li><li>4.3. Dependencies and Considerations: \1. What versions of ArrayOS need to support this feature?\2. Does this feature have a client component, and what are the supported client OS? 3. Does this feature require any integration with HA, Clustering, Webwall, Client Security, etc,?</li><li>4.4. Future Enhancements (Optional)\1. What is still missing for a complete solution? \2What needs to be done to improve the usability or performance?</li><li>5.1 System Administrator [This section should cover the following contents:What does the end user see/experience, for example Array Client UI, Authorization, Portal theme, etc.]</li><li>6.1 Backward Compatibility</li><li>7.1 Platform Support (Optional)[This section should cover the following contents: Feature Matrix for clients or servers, etc.]</li><li>8.1 Packaging Consideration[This section should cover the following contents: How the software can be delivered to the target machine. Is feature control, additional or special HW required? If no, input “None” here.]</li><li>9.1 Security Consideration</li><li>10.1 Testing Consideration [This section should cover the following contents: Test requirement, equipment, setup, and test scenarios for black box testing. If no, input “None” here.]</li><li>11.1 Troubleshooting Consideration [This section should cover the troubleshooting methods or tools, etc.]</li><li>12.1 Issue and Limitation [This section should cover the existing issues and known limitations from the external perspective.]</li><li>13.1 Reference 各种RFC之类的资料</li></ul><p>如果是设计文档，那么在detailed description里面还得加上：[Input the text here.</p><p><em>This section describes the high-level software architecture design/implementation of the internal and detailed external programming interface (API)<strong>, even with ported code</strong>s.</em></p><p>*<strong>In addition, the following information MUST be provided if any:*</strong></p><p>*<strong>1. Platform:*</strong> <em>List which platforms this feature/function will be supported on.</em></p><p>*<strong>2. Boundary conditions:*</strong> <em>Should list some maximum numbers related to this feature/function, such as the maximum number of users.</em></p><p>*<strong>3. Error handling:*</strong> <em>Should state how errors are handled.</em></p><p>*<strong>4. Security:*</strong> <em>Security considerations are an important part of a project. We should detail possibilities of abuse of the system.</em>]</p><p>*<strong>A separate*</strong> *<strong>Design Document for more detailed internal design can be referenced in case more design details is required,*</strong> *<strong>such as internal data structure, flow chart, algorithm used, exact*</strong> *<strong>code, etc.*</strong>]</p><h4 class="relative group"><div id=heading class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#heading aria-label=锚点>#</a></span></h4><h2 class="relative group">一些学习到的常见的小技巧<div id=%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0%E5%88%B0%E7%9A%84%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0%E5%88%B0%E7%9A%84%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7 aria-label=锚点>#</a></span></h2><h3 class="relative group">位运算<div id=%E4%BD%8D%E8%BF%90%E7%AE%97 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%BD%8D%E8%BF%90%E7%AE%97 aria-label=锚点>#</a></span></h3><p>最常见的例子应该是linux内核的GFP_ZONE_TABLE，如果ZONES的个数小于8，那么GFP_ZONES_SHIFT为3。具体的看代码每一个OPT_ZONE_XXX实际上就是存在情况下的ZONE_XXX，因此我们能看出来，那么我们可以看到，每个___GFP_XXX对应了一个左移的次数，不同的ZONE对应不同的左移的位数，当找需要计算的GFP_ZONE的时候，需要先获取GFP_FLAGS的低四位。 低四位就是计算的时候想要的___GFP_XXX然后将GFP_ZONE_TABLE右移bit*GFP_ZONES_SHIFT位，最后用<code>(1 &lt;&lt; GFP_ZONES_SHIFT) - 1</code>将具体的ZONE的个数的为都置为1。然后取出来一样的。如果还有不明白的建议看这个网页https://richardweiyang-2.gitbook.io/kernel-exploring/00-memory_a_bottom_up_view/12-gfp_usage</p><table><thead><tr><th>ZONE_XXX</th><th>VALUE</th></tr></thead><tbody><tr><td>ZONE_DMA</td><td>0</td></tr><tr><td>ZONE_DMA32</td><td>1</td></tr><tr><td>ZONE_NORMAL</td><td>2</td></tr><tr><td>ZONE_HIGHMEM</td><td>3</td></tr><tr><td>ZONE_MOVABLE</td><td>4</td></tr><tr><td>ZONE_DEVICE</td><td>5</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define GFP_ZONE_TABLE ( \
</span></span></span><span class=line><span class=cl><span class=cp>	(ZONE_NORMAL &lt;&lt; 0 * GFP_ZONES_SHIFT)				       \
</span></span></span><span class=line><span class=cl><span class=cp>	| (OPT_ZONE_DMA &lt;&lt; ___GFP_DMA * GFP_ZONES_SHIFT)		       \
</span></span></span><span class=line><span class=cl><span class=cp>	| (OPT_ZONE_HIGHMEM &lt;&lt; ___GFP_HIGHMEM * GFP_ZONES_SHIFT)	       \
</span></span></span><span class=line><span class=cl><span class=cp>	| (OPT_ZONE_DMA32 &lt;&lt; ___GFP_DMA32 * GFP_ZONES_SHIFT)		       \
</span></span></span><span class=line><span class=cl><span class=cp>	| (ZONE_NORMAL &lt;&lt; ___GFP_MOVABLE * GFP_ZONES_SHIFT)		       \
</span></span></span><span class=line><span class=cl><span class=cp>	| (OPT_ZONE_DMA &lt;&lt; (___GFP_MOVABLE | ___GFP_DMA) * GFP_ZONES_SHIFT)    \
</span></span></span><span class=line><span class=cl><span class=cp>	| (ZONE_MOVABLE &lt;&lt; (___GFP_MOVABLE | ___GFP_HIGHMEM) * GFP_ZONES_SHIFT)\
</span></span></span><span class=line><span class=cl><span class=cp>	| (OPT_ZONE_DMA32 &lt;&lt; (___GFP_MOVABLE | ___GFP_DMA32) * GFP_ZONES_SHIFT)\
</span></span></span><span class=line><span class=cl><span class=cp>)
</span></span></span></code></pre></div><h3 class="relative group">优先级<div id=%E4%BC%98%E5%85%88%E7%BA%A7 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E4%BC%98%E5%85%88%E7%BA%A7 aria-label=锚点>#</a></span></h3><p>linux的实时程序和普通进程的优先级很有趣，用了一种超级简单的方式来区分这两种进程的优先级：</p><ul><li>实时程序用的优先级是<code>weight = 1000 + p->rt_priority;</code></li><li>而普通程序就是简单的<code>weight = p->counter;if (!weight) goto out; weight += 20 - p->nice;</code>。所以如果该进程的时间片耗尽，那么就讲优先级置成0，在本轮调度中没有机会了。这个方法实际上在《现代操作系统》里面有说。</li></ul><p>现在让我们回忆一下操作系统几种常见的调度方式：</p><ul><li>最短作业方法</li><li>FIFO</li><li>最短剩余时间</li></ul><h2 class="relative group">结尾<div id=%E7%BB%93%E5%B0%BE class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%E7%BB%93%E5%B0%BE aria-label=锚点>#</a></span></h2><p>唉，尴尬</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://i.loli.net/2020/08/27/BFHNyfpx3EsIDUG.jpg alt=狗头的赞赏码.jpg></figure></p></div></div><script>var oid="views_posts\\2020-12-15-异步程序编写时的一些小教训\\index.md",oid_likes="likes_posts\\2020-12-15-异步程序编写时的一些小教训\\index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/2020-12-09-%E9%98%85%E8%AF%BB%E5%86%85%E6%A0%B8%E7%A8%8B%E5%BA%8F%E5%91%98smp%E7%9A%84%E4%BF%AE%E5%85%BB/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">阅读内核程序员的smp修养</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2020-12-09T00:00:00+00:00>2020 年 12 月 9 日</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/2020-12-15-%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%92%8C%E8%AF%8A%E6%96%AD/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">如何进行性能分析和诊断</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2020-12-15T00:00:00+00:00>2020 年 12 月 15 日</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=返回顶部 title=返回顶部>&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2025 - 2025 菜狗 All Rights Reserved.</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a> 强力驱动</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://hxndg.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>